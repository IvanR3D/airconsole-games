<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEAM Trivia - Fundaci√≥n STEAM RD</title>
    <script src="https://www.airconsole.com/api/airconsole-1.8.0.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Colores STEAM RD */
        :root {
            --steam-turquesa: #0595AE;
            --steam-morado: #AB3D8B;
            --steam-naranja: #EB8225;
            --steam-verde: #73A03F;
            --steam-negro: #010101;
            --steam-blanco: #FFFFFF;
        }

        body {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            min-height: 100vh;
            color: var(--steam-negro);
            overflow: hidden;
            background: var(--steam-blanco);
            transition: background 0.5s ease;
        }

        /* Fondos por categor√≠a - tonos claros */
        body.cat-general { background: linear-gradient(135deg, #E8F4F8 0%, #F0F8FF 100%); }
        body.cat-science { background: linear-gradient(135deg, #E8F5E9 0%, #F1F8E9 100%); }
        body.cat-mathematics { background: linear-gradient(135deg, #E3F2FD 0%, #E8F4F8 100%); }
        body.cat-robotics { background: linear-gradient(135deg, #FCE4EC 0%, #F3E5F5 100%); }
        body.cat-chemistry { background: linear-gradient(135deg, #E8F5E9 0%, #F1F8E9 100%); }
        body.cat-technology { background: linear-gradient(135deg, #F3E5F5 0%, #EDE7F6 100%); }
        body.cat-history { background: linear-gradient(135deg, #FFF3E0 0%, #FBE9E7 100%); }
        body.cat-geography { background: linear-gradient(135deg, #E0F7FA 0%, #E3F2FD 100%); }
        body.cat-default { background: var(--steam-blanco); }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .screen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .screen.active {
            display: flex;
            opacity: 1;
        }

        /* HEADER */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            position: relative;
        }

        .timer-bar-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .timer-bar {
            width: 60%;
            height: 30px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 20px;
            overflow: visible;
            position: relative;
            border: 3px solid var(--steam-turquesa);
        }

        .timer-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--steam-verde) 0%, var(--steam-naranja) 50%, var(--steam-morado) 100%);
            border-radius: 17px;
            transition: width 0.1s linear;
            position: relative;
            width: 100%;
        }

        .timer-bar-fill::after {
            content: '';
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid var(--steam-morado);
            border-top: 15px solid transparent;
            border-bottom: 15px solid transparent;
        }

        .timer-circle {
            width: 80px;
            height: 80px;
            background: var(--steam-turquesa);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 15px rgba(5, 149, 174, 0.4);
            border: 4px solid white;
            transition: background 0.3s, transform 0.1s;
        }

        .timer-circle.warning {
            background: var(--steam-naranja);
            animation: pulse 0.5s ease infinite;
        }

        .timer-circle.danger {
            background: var(--steam-morado);
            animation: shake 0.3s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        /* WAITING SCREEN */
        .waiting-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .logo-container {
            margin-bottom: 30px;
        }

        .logo {
            font-size: 3.5em;
            font-weight: 900;
            background: linear-gradient(45deg, var(--steam-turquesa), var(--steam-morado), var(--steam-naranja), var(--steam-verde));
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientMove 3s ease infinite;
            filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.1));
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .waiting-title {
            font-size: 2em;
            margin-bottom: 15px;
            color: var(--steam-turquesa);
        }

        .waiting-subtitle {
            font-size: 1.3em;
            color: var(--steam-negro);
            opacity: 0.7;
            margin-bottom: 30px;
        }

        .players-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
            max-width: 800px;
        }

        .player-card {
            background: white;
            border: 3px solid #E0E0E0;
            border-radius: 15px;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .player-card.admin {
            border-color: var(--steam-naranja);
            background: #FFF8F0;
        }

        .player-card.disconnected {
            border-color: var(--steam-morado);
            background: #FDF0F5;
            opacity: 0.6;
        }

        .player-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .player-name {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--steam-negro);
        }

        .player-status {
            font-size: 0.85em;
            color: var(--steam-verde);
        }

        .admin-controls-hint {
            background: #FFF8F0;
            border: 2px solid var(--steam-naranja);
            border-radius: 15px;
            padding: 15px 25px;
            margin-top: 20px;
            text-align: center;
        }

        .admin-controls-hint p {
            color: var(--steam-naranja);
            font-weight: bold;
        }

        /* CATEGORY SELECTION */
        .category-screen {
            padding: 30px;
            overflow-y: auto;
        }

        .category-title {
            text-align: center;
            font-size: 2em;
            color: var(--steam-turquesa);
            margin-bottom: 30px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            max-width: 1000px;
            margin: 0 auto 30px;
        }

        .category-card {
            background: white;
            border: 3px solid #E0E0E0;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .category-card:hover {
            border-color: var(--steam-turquesa);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(5, 149, 174, 0.2);
        }

        .category-card.selected {
            border-color: var(--steam-verde);
            background: #F5FAF0;
            box-shadow: 0 0 20px rgba(115, 160, 63, 0.3);
        }

        .category-emoji {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .category-name {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--steam-negro);
        }

        /* PLAYING SCREEN */
        .playing-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 0 40px 30px;
        }

        .question-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .question-number {
            font-size: 1.1em;
            color: var(--steam-turquesa);
            margin-bottom: 15px;
            font-weight: bold;
        }

        .question-text {
            font-size: 2.2em;
            text-align: center;
            max-width: 900px;
            line-height: 1.3;
            margin-bottom: 40px;
            color: var(--steam-negro);
        }

        /* OPTIONS GRID */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 900px;
            width: 100%;
        }

        .option-card {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s ease;
            border: 3px solid #E0E0E0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .option-letter {
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2em;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }

        .option-card.option-a .option-letter { background: var(--steam-verde); }
        .option-card.option-b .option-letter { background: var(--steam-morado); }
        .option-card.option-c .option-letter { background: var(--steam-turquesa); }
        .option-card.option-d .option-letter { background: var(--steam-naranja); }

        .option-text {
            flex: 1;
            padding: 15px 20px;
            font-size: 1.2em;
            font-weight: 500;
            color: var(--steam-negro);
        }

        .option-card.correct {
            background: var(--steam-verde);
            border-color: var(--steam-verde);
            animation: correctPop 0.3s ease;
        }

        .option-card.correct .option-text {
            color: white;
        }

        .option-card.incorrect {
            background: var(--steam-morado);
            border-color: var(--steam-morado);
            animation: incorrectShake 0.3s ease;
        }

        .option-card.incorrect .option-text {
            color: white;
        }

        @keyframes correctPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* FOOTER */
        .game-footer {
            display: flex;
            align-items: center;
            padding: 15px 40px;
            gap: 20px;
            background: rgba(255,255,255,0.9);
            border-top: 2px solid #E0E0E0;
        }

        .trivia-logo {
            width: 120px;
            height: 80px;
            background: linear-gradient(135deg, var(--steam-turquesa), var(--steam-morado));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .trivia-logo-text {
            font-size: 1.3em;
            font-weight: bold;
            color: white;
        }

        .players-status {
            display: flex;
            gap: 12px;
            flex: 1;
            flex-wrap: wrap;
        }

        .player-status-card {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 8px 15px;
            border-radius: 10px;
            border: 2px solid #E0E0E0;
            transition: all 0.2s ease;
        }

        .player-status-card.answered {
            background: #F5FAF0;
            border-color: var(--steam-verde);
        }

        .player-status-card.disconnected {
            background: #FDF0F5;
            border-color: var(--steam-morado);
        }

        .player-status-icon {
            font-size: 1.3em;
        }

        .player-status-name {
            font-weight: bold;
            font-size: 0.9em;
            color: var(--steam-negro);
        }

        /* SCOREBOARD */
        .scoreboard {
            position: absolute;
            top: 110px;
            right: 20px;
            background: white;
            border-radius: 15px;
            padding: 15px;
            min-width: 180px;
            border: 2px solid #E0E0E0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .scoreboard-title {
            font-size: 1.1em;
            color: var(--steam-turquesa);
            margin-bottom: 12px;
            text-align: center;
            font-weight: bold;
        }

        .scoreboard-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .scoreboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background: #F5F5F5;
            border-radius: 8px;
            font-size: 0.9em;
            color: var(--steam-negro);
        }

        .scoreboard-item.first {
            background: #FFF8F0;
            border: 2px solid var(--steam-naranja);
        }

        /* END SCREEN */
        .end-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .end-title {
            font-size: 2.5em;
            color: var(--steam-turquesa);
            margin-bottom: 30px;
        }

        .winner-section {
            text-align: center;
            margin-bottom: 30px;
            animation: winnerBounce 0.5s ease;
        }

        @keyframes winnerBounce {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .winner-crown {
            font-size: 4em;
            margin-bottom: 10px;
        }

        .winner-name {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--steam-naranja);
        }

        .winner-score {
            font-size: 1.5em;
            color: var(--steam-verde);
            margin-top: 10px;
        }

        .podium {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 500px;
            width: 100%;
            margin-bottom: 30px;
        }

        .podium-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            border-radius: 15px;
            background: white;
            border: 3px solid #E0E0E0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .podium-item.first {
            background: linear-gradient(135deg, #FFF8E1, #FFECB3);
            border-color: var(--steam-naranja);
        }

        .podium-item.second {
            background: linear-gradient(135deg, #F5F5F5, #E0E0E0);
            border-color: #9E9E9E;
        }

        .podium-item.third {
            background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
            border-color: #FF9800;
        }

        .podium-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .podium-rank {
            font-size: 1.5em;
            font-weight: bold;
        }

        .podium-name {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--steam-negro);
        }

        .podium-score {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--steam-turquesa);
        }

        .waiting-admin {
            background: #FFF8F0;
            border: 2px solid var(--steam-naranja);
            border-radius: 15px;
            padding: 20px 30px;
            text-align: center;
            animation: pulse 2s ease infinite;
        }

        .waiting-admin p {
            color: var(--steam-naranja);
            font-size: 1.2em;
            font-weight: bold;
        }

        /* CONFETTI */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confettiFall 3s ease-out forwards;
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .sound-toggle {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 2em;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s;
            z-index: 100;
        }

        .sound-toggle:hover {
            opacity: 1;
        }
    </style>
</head>
<body class="cat-default">
    <div class="container">
        <!-- WAITING SCREEN -->
        <div class="screen waiting-screen active" id="waitingScreen">
            <div class="waiting-content">
                <div class="logo-container">
                    <div class="logo">üéØ STEAM TRIVIA üéØ</div>
                </div>
                <h2 class="waiting-title">¬°Esperando Jugadores!</h2>
                <p class="waiting-subtitle">Escanea el c√≥digo QR con tu tel√©fono para unirte</p>
                <div class="players-grid" id="playersGrid"></div>
                <div class="admin-controls-hint" id="adminHint" style="display: none;">
                    <p>üëë El Jugador 1 controla el juego desde su tel√©fono</p>
                </div>
            </div>
        </div>

        <!-- CATEGORY SCREEN -->
        <div class="screen category-screen" id="categoryScreen">
            <h2 class="category-title">üéÆ Jugador 1: Selecciona una Categor√≠a</h2>
            <div class="category-grid" id="categoryGrid"></div>
            <div class="admin-controls-hint">
                <p>‚è≥ Esperando que el Jugador 1 seleccione categor√≠a e inicie...</p>
            </div>
        </div>

        <!-- PLAYING SCREEN -->
        <div class="screen playing-screen" id="playingScreen">
            <div class="game-header">
                <div class="timer-bar-container">
                    <div class="timer-bar">
                        <div class="timer-bar-fill" id="timerBarFill"></div>
                    </div>
                </div>
                <div class="timer-circle" id="timerCircle">20</div>
            </div>

            <div class="playing-content">
                <div class="question-section">
                    <div class="question-number" id="questionNumber">Pregunta 1 de 5</div>
                    <h2 class="question-text" id="questionText">¬øCu√°l es la capital de Francia?</h2>
                    <div class="options-grid" id="optionsGrid"></div>
                </div>
            </div>

            <div class="game-footer">
                <div class="trivia-logo">
                    <span class="trivia-logo-text">STEAM</span>
                </div>
                <div class="players-status" id="playersStatus"></div>
            </div>

            <div class="scoreboard" id="scoreboard">
                <div class="scoreboard-title">üèÜ Puntuaci√≥n</div>
                <div class="scoreboard-list" id="scoreboardList"></div>
            </div>
        </div>

        <!-- END SCREEN -->
        <div class="screen end-screen" id="endScreen">
            <div class="end-content">
                <h2 class="end-title">üèÜ ¬°Juego Terminado! üèÜ</h2>
                <div class="winner-section" id="winnerSection"></div>
                <div class="podium" id="podium"></div>
                <div class="waiting-admin">
                    <p>‚è≥ Esperando que el Jugador 1 decida...</p>
                </div>
            </div>
        </div>

        <div class="sound-toggle" id="soundToggle">üîä</div>
        <div class="confetti-container" id="confettiContainer"></div>
    </div>

    <script>
        // Categories
        const categories = {
            general: { name: "General", emoji: "üåç", color: "general" },
            science: { name: "Ciencia", emoji: "üî¨", color: "science" },
            mathematics: { name: "Matem√°ticas", emoji: "üìê", color: "mathematics" },
            robotics: { name: "Rob√≥tica", emoji: "ü§ñ", color: "robotics" },
            chemistry: { name: "Qu√≠mica", emoji: "‚öóÔ∏è", color: "chemistry" },
            technology: { name: "Tecnolog√≠a", emoji: "üíª", color: "technology" },
            history: { name: "Historia", emoji: "üìú", color: "history" },
            geography: { name: "Geograf√≠a", emoji: "üó∫Ô∏è", color: "geography" }
        };

        // Questions database
        const questions = {
            general: [
                { question: "¬øCu√°l es la capital de Francia?", options: ["Londres", "Par√≠s", "Berl√≠n", "Madrid"], correct: 1 },
                { question: "¬øEn qu√© a√±o lleg√≥ el hombre a la Luna?", options: ["1965", "1969", "1972", "1975"], correct: 1 },
                { question: "¬øQui√©n pint√≥ la Mona Lisa?", options: ["Picasso", "Van Gogh", "Leonardo da Vinci", "Miguel √Ångel"], correct: 2 },
                { question: "¬øCu√°l es el oc√©ano m√°s grande del mundo?", options: ["Atl√°ntico", "√çndico", "√Årtico", "Pac√≠fico"], correct: 3 },
                { question: "¬øCu√°ntos continentes hay en la Tierra?", options: ["5", "6", "7", "8"], correct: 2 }
            ],
            science: [
                { question: "¬øCu√°l es el elemento qu√≠mico del oro?", options: ["Go", "Gd", "Au", "Ag"], correct: 2 },
                { question: "¬øQu√© planeta es el m√°s cercano al Sol?", options: ["Venus", "Mercurio", "Marte", "Tierra"], correct: 1 },
                { question: "¬øCu√°ntos huesos tiene el cuerpo humano adulto?", options: ["196", "206", "216", "226"], correct: 1 },
                { question: "¬øCu√°l es el animal m√°s grande del mundo?", options: ["Elefante", "Tibur√≥n blanco", "Ballena azul", "Jirafa"], correct: 2 },
                { question: "¬øCu√°l es la galaxia en la que vivimos?", options: ["Andr√≥meda", "V√≠a L√°ctea", "Sombrero", "Tri√°ngulo"], correct: 1 }
            ],
            mathematics: [
                { question: "¬øCu√°nto es 2 + 2 √ó 3?", options: ["12", "8", "10", "6"], correct: 1 },
                { question: "¬øCu√°l es la ra√≠z cuadrada de 144?", options: ["10", "11", "12", "13"], correct: 2 },
                { question: "¬øCu√°ntos grados tiene un tri√°ngulo?", options: ["180¬∞", "360¬∞", "90¬∞", "270¬∞"], correct: 0 },
                { question: "¬øCu√°l es el n√∫mero œÄ (pi) aproximadamente?", options: ["2.14", "3.14", "4.14", "5.14"], correct: 1 },
                { question: "¬øCu√°ntos lados tiene un hex√°gono?", options: ["4", "5", "6", "7"], correct: 2 }
            ],
            robotics: [
                { question: "¬øQu√© significa 'AI' en rob√≥tica?", options: ["Automated Intelligence", "Artificial Intelligence", "Advanced Integration", "Automatic Interface"], correct: 1 },
                { question: "¬øQu√© sensor se usa para detectar obst√°culos?", options: ["GPS", "Ultrasonido", "Bluetooth", "WiFi"], correct: 1 },
                { question: "¬øQu√© lenguaje se usa com√∫nmente en Arduino?", options: ["Python", "Java", "C/C++", "JavaScript"], correct: 2 },
                { question: "¬øQu√© es un actuador en rob√≥tica?", options: ["Sensor", "Motor", "Bater√≠a", "Procesador"], correct: 1 },
                { question: "¬øQu√© es ROS en rob√≥tica?", options: ["Robot Operating System", "Robotic Output System", "Remote Operation Software", "Robot Optimization Suite"], correct: 0 }
            ],
            chemistry: [
                { question: "¬øCu√°l es el s√≠mbolo del elemento ox√≠geno?", options: ["Ox", "O2", "O", "Ox2"], correct: 2 },
                { question: "¬øCu√°ntos elementos hay en la tabla peri√≥dica?", options: ["108", "118", "128", "138"], correct: 1 },
                { question: "¬øCu√°l es la f√≥rmula del di√≥xido de carbono?", options: ["CO", "CO2", "C2O", "C2O2"], correct: 1 },
                { question: "¬øQu√© pH tiene una sustancia neutra?", options: ["0", "7", "14", "10"], correct: 1 },
                { question: "¬øCu√°l es la f√≥rmula qu√≠mica del agua?", options: ["H2", "O2", "H2O", "HO"], correct: 2 }
            ],
            technology: [
                { question: "¬øQu√© significa 'www' en una direcci√≥n web?", options: ["World Wide Web", "World Web Way", "Wide World Web", "Web World Wide"], correct: 0 },
                { question: "¬øQu√© compa√±√≠a cre√≥ Android?", options: ["Apple", "Microsoft", "Google", "Samsung"], correct: 2 },
                { question: "¬øQu√© significa 'CPU'?", options: ["Central Processing Unit", "Computer Power Unit", "Control Processing Unit", "Central Power Unit"], correct: 0 },
                { question: "¬øQu√© significa 'HTML'?", options: ["HyperText Markup Language", "High Tech Machine Learning", "Home Tool Management List", "Hyper Transfer Media Link"], correct: 0 },
                { question: "¬øQu√© compa√±√≠a cre√≥ Windows?", options: ["Apple", "Google", "Microsoft", "IBM"], correct: 2 }
            ],
            history: [
                { question: "¬øEn qu√© a√±o cay√≥ el Imperio Romano de Occidente?", options: ["410", "476", "500", "600"], correct: 1 },
                { question: "¬øQui√©n fue el primer presidente de EE.UU.?", options: ["Jefferson", "Lincoln", "Washington", "Adams"], correct: 2 },
                { question: "¬øQu√© civilizaci√≥n construy√≥ las pir√°mides de Giza?", options: ["Griega", "Egipcia", "Romana", "Maya"], correct: 1 },
                { question: "¬øEn qu√© a√±o termin√≥ la Segunda Guerra Mundial?", options: ["1943", "1944", "1945", "1946"], correct: 2 },
                { question: "¬øEn qu√© a√±o lleg√≥ Col√≥n a Am√©rica?", options: ["1492", "1500", "1510", "1520"], correct: 0 }
            ],
            geography: [
                { question: "¬øCu√°l es el r√≠o m√°s largo del mundo?", options: ["Amazonas", "Nilo", "Yangts√©", "Misisipi"], correct: 1 },
                { question: "¬øCu√°l es la monta√±a m√°s alta del mundo?", options: ["K2", "Kangchenjunga", "Everest", "Makalu"], correct: 2 },
                { question: "¬øCu√°l es la capital de Australia?", options: ["S√≠dney", "Melbourne", "Canberra", "Brisbane"], correct: 2 },
                { question: "¬øCu√°l es el desierto m√°s grande del mundo?", options: ["Sahara", "Gobi", "Ant√°rtico", "Arabia"], correct: 0 },
                { question: "¬øCu√°l es la capital de Canad√°?", options: ["Toronto", "Vancouver", "Montreal", "Ottawa"], correct: 3 }
            ]
        };

        const playerColors = ['#0595AE', '#73A03F', '#EB8225', '#AB3D8B'];
        
        let airconsole;
        let players = {};
        let gameState = 'waiting';
        let currentQuestion = 0;
        let gameQuestions = [];
        let questionStartTime = 0;
        let answers = {};
        let selectedCategory = 'general';
        let timer = null;
        let timeLeft = 20;
        let soundEnabled = true;
        let adminDeviceId = null;

        // Performance: cachear elementos DOM
        const domCache = {
            timerCircle: null,
            timerBarFill: null,
            questionNumber: null,
            questionText: null,
            optionsGrid: null,
            playersStatus: null,
            scoreboardList: null,
            playersGrid: null,
            adminHint: null
        };

        function cacheDomElements() {
            domCache.timerCircle = document.getElementById('timerCircle');
            domCache.timerBarFill = document.getElementById('timerBarFill');
            domCache.questionNumber = document.getElementById('questionNumber');
            domCache.questionText = document.getElementById('questionText');
            domCache.optionsGrid = document.getElementById('optionsGrid');
            domCache.playersStatus = document.getElementById('playersStatus');
            domCache.scoreboardList = document.getElementById('scoreboardList');
            domCache.playersGrid = document.getElementById('playersGrid');
            domCache.adminHint = document.getElementById('adminHint');
        }

        // Performance: usar requestAnimationFrame para timer
        let timerAnimationId = null;
        let timerStartTime = 0;
        const TIMER_DURATION = 20000; // 20 segundos

        let audioContext;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playSound(type) {
            if (!soundEnabled) return;
            initAudio();
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'join':
                    oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(784, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;
                case 'correct':
                    [523, 659, 784].forEach((freq, i) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0.15, audioContext.currentTime + i * 0.08);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.08 + 0.15);
                        osc.start(audioContext.currentTime + i * 0.08);
                        osc.stop(audioContext.currentTime + i * 0.08 + 0.15);
                    });
                    break;
                case 'wrong':
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.3);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
                case 'tick':
                    oscillator.frequency.value = 800;
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.05);
                    break;
                case 'victory':
                    [523, 659, 784, 1047].forEach((freq, i) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.15);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.15 + 0.3);
                        osc.start(audioContext.currentTime + i * 0.15);
                        osc.stop(audioContext.currentTime + i * 0.15 + 0.3);
                    });
                    break;
            }
        }

        function createConfetti() {
            const container = document.getElementById('confettiContainer');
            container.innerHTML = '';
            const colors = ['#0595AE', '#AB3D8B', '#EB8225', '#73A03F'];
            
            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = (2 + Math.random() * 2) + 's';
                container.appendChild(confetti);
            }
            
            setTimeout(() => container.innerHTML = '', 5000);
        }

        function setCategoryBackground(category) {
            document.body.className = 'cat-' + (categories[category]?.color || 'default');
        }

        function init() {
            airconsole = new AirConsole();
            cacheDomElements();

            airconsole.onReady = function() {
                console.log('Screen ready');
                setupCategories();
            };

            airconsole.onConnect = function(deviceId) {
                console.log('Device connected:', deviceId);
            };

            airconsole.onDisconnect = function(deviceId) {
                if (players[deviceId]) {
                    players[deviceId].disconnected = true;
                    updatePlayersDisplay();
                    airconsole.broadcast({ action: 'playerDisconnected', playerId: deviceId, playerName: players[deviceId].name });
                }
            };

            airconsole.onMessage = function(deviceId, data) {
                console.log("Received:", data.action, "from", deviceId);
                
                if (data.action === 'join') {
                    const isAdmin = adminDeviceId === null;
                    if (isAdmin) adminDeviceId = deviceId;
                    
                    players[deviceId] = {
                        id: deviceId,
                        name: data.name,
                        emoji: data.emoji,
                        score: 0,
                        color: playerColors[Object.keys(players).length % playerColors.length],
                        isAdmin: isAdmin,
                        disconnected: false
                    };
                    
                    playSound('join');
                    updatePlayersDisplay();
                    
                    airconsole.message(deviceId, { 
                        action: 'joined', 
                        color: players[deviceId].color,
                        emoji: data.emoji,
                        isAdmin: isAdmin,
                        gameState: gameState,
                        selectedCategory: selectedCategory
                    });
                    
                    if (isAdmin && gameState === 'waiting') {
                        showScreen('category');
                        gameState = 'categorySelect';
                    }
                    
                    broadcastGameState();
                    
                } else if (data.action === 'selectCategory' && deviceId === adminDeviceId) {
                    selectedCategory = data.category;
                    setCategoryBackground(selectedCategory);
                    
                    document.querySelectorAll('.category-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    document.querySelector(`[data-category="${data.category}"]`)?.classList.add('selected');
                    
                    airconsole.broadcast({ action: 'categorySelected', category: data.category });
                    
                } else if (data.action === 'startGame' && deviceId === adminDeviceId) {
                    startGame();
                    
                } else if (data.action === 'answer' && gameState === 'playing') {
                    handleAnswer(deviceId, data.option, data.timestamp);
                    
                } else if (data.action === 'playAgain' && deviceId === adminDeviceId) {
                    resetGame();
                }
            };

            document.getElementById('soundToggle').addEventListener('click', toggleSound);
        }

        function broadcastGameState() {
            airconsole.broadcast({
                action: 'gameStateUpdate',
                gameState: gameState,
                selectedCategory: selectedCategory,
                players: players,
                adminId: adminDeviceId
            });
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').textContent = soundEnabled ? 'üîä' : 'üîá';
        }

        function setupCategories() {
            const grid = document.getElementById('categoryGrid');
            grid.innerHTML = '';
            Object.entries(categories).forEach(([key, category]) => {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.dataset.category = key;
                card.innerHTML = `
                    <div class="category-emoji">${category.emoji}</div>
                    <div class="category-name">${category.name}</div>
                `;
                grid.appendChild(card);
            });
            document.querySelector('.category-card')?.classList.add('selected');
        }

        function updatePlayersDisplay() {
            const grid = domCache.playersGrid || document.getElementById('playersGrid');
            const fragment = document.createDocumentFragment();
            
            Object.values(players).forEach(player => {
                const card = document.createElement('div');
                card.className = `player-card ${player.isAdmin ? 'admin' : ''} ${player.disconnected ? 'disconnected' : ''}`;
                card.innerHTML = `
                    <div class="player-avatar" style="background-color: ${player.color}">${player.emoji}</div>
                    <div>
                        <div class="player-name">${player.name}</div>
                        <div class="player-status">
                            ${player.disconnected ? '‚ùå Desconectado' : (player.isAdmin ? 'üëë Admin' : '‚úì Conectado')}
                        </div>
                    </div>
                `;
                fragment.appendChild(card);
            });
            
            grid.innerHTML = '';
            grid.appendChild(fragment);

            const adminHint = domCache.adminHint || document.getElementById('adminHint');
            if (adminHint && Object.keys(players).length >= 1) {
                adminHint.style.display = 'block';
            }

            updatePlayersStatus();
        }

        function updatePlayersStatus() {
            const container = domCache.playersStatus || document.getElementById('playersStatus');
            if (!container) return;
            
            const fragment = document.createDocumentFragment();
            Object.values(players).forEach(player => {
                const hasAnswered = answers[player.id] !== undefined;
                const card = document.createElement('div');
                card.className = `player-status-card ${hasAnswered ? 'answered' : ''} ${player.disconnected ? 'disconnected' : ''}`;
                card.innerHTML = `
                    <span class="player-status-icon">${player.emoji}</span>
                    <span class="player-status-name">${player.name}</span>
                    ${player.disconnected ? '<span style="color: #AB3D8B;">‚ùå</span>' : (hasAnswered ? '<span style="color: #73A03F;">‚úì</span>' : '<span style="color: #999;">‚è≥</span>')}
                `;
                fragment.appendChild(card);
            });
            container.innerHTML = '';
            container.appendChild(fragment);
        }

        function startGame() {
            gameState = 'playing';
            currentQuestion = 0;
            
            const categoryQuestions = questions[selectedCategory] || questions.general;
            gameQuestions = [...categoryQuestions].sort(() => Math.random() - 0.5).slice(0, 5);
            
            Object.keys(players).forEach(id => {
                players[id].score = 0;
            });

            setCategoryBackground(selectedCategory);
            showScreen('playing');
            
            airconsole.broadcast({ 
                action: 'gameStart',
                category: selectedCategory,
                question: { index: currentQuestion, total: gameQuestions.length }
            });
            
            setTimeout(() => showQuestion(), 300);
        }

        function showQuestion() {
            answers = {};
            questionStartTime = Date.now();
            timeLeft = 20;
            
            const question = gameQuestions[currentQuestion];
            if (domCache.questionNumber) domCache.questionNumber.textContent = `Pregunta ${currentQuestion + 1} de ${gameQuestions.length}`;
            if (domCache.questionText) domCache.questionText.textContent = question.question;
            
            displayOptions(question);
            updatePlayersStatus();
            updateScoreboard();
            startTimer();
            
            airconsole.broadcast({
                action: 'showQuestion',
                questionIndex: currentQuestion,
                totalQuestions: gameQuestions.length
            });
        }

        function displayOptions(question) {
            const container = domCache.optionsGrid || document.getElementById('optionsGrid');
            container.innerHTML = '';
            
            const letters = ['A', 'B', 'C', 'D'];
            const classes = ['option-a', 'option-b', 'option-c', 'option-d'];
            
            // Usar fragment para mejor rendimiento
            const fragment = document.createDocumentFragment();
            question.options.forEach((option, index) => {
                const card = document.createElement('div');
                card.className = `option-card ${classes[index]}`;
                card.dataset.index = index;
                card.innerHTML = `
                    <div class="option-letter">${letters[index]}</div>
                    <div class="option-text">${option}</div>
                `;
                fragment.appendChild(card);
            });
            container.appendChild(fragment);
        }

        function startTimer() {
            clearInterval(timer);
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 5) {
                    playSound('tick');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    showResults();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const circle = domCache.timerCircle;
            const barFill = domCache.timerBarFill;
            if (!circle || !barFill) return;
            
            circle.textContent = timeLeft;
            const percentage = (timeLeft / 20) * 100;
            barFill.style.width = `${percentage}%`;
            
            // Optimizar cambio de clases
            const classList = circle.classList;
            if (timeLeft <= 5) {
                if (!classList.contains('danger')) {
                    classList.remove('warning');
                    classList.add('danger');
                }
            } else if (timeLeft <= 10) {
                if (!classList.contains('warning')) {
                    classList.remove('danger');
                    classList.add('warning');
                }
            } else {
                classList.remove('warning', 'danger');
            }
        }

        function handleAnswer(playerId, optionIndex, timestamp) {
            if (answers[playerId] || players[playerId]?.disconnected) return;

            const timeElapsed = timestamp - questionStartTime;
            const isCorrect = optionIndex === gameQuestions[currentQuestion].correct;

            answers[playerId] = {
                option: optionIndex,
                correct: isCorrect,
                time: timeElapsed
            };

            if (isCorrect) {
                const points = Math.max(100, Math.floor(1000 - (timeElapsed / 20)));
                players[playerId].score += points;
                playSound('correct');
                
                airconsole.message(playerId, { 
                    action: 'result', 
                    correct: true, 
                    points: points
                });
            } else {
                playSound('wrong');
                airconsole.message(playerId, { 
                    action: 'result', 
                    correct: false, 
                    points: 0
                });
            }

            updatePlayersStatus();

            const activePlayers = Object.values(players).filter(p => !p.disconnected);
            if (Object.keys(answers).length >= activePlayers.length) {
                clearInterval(timer);
                setTimeout(() => showResults(), 800);
            }
        }

        function showResults() {
            clearInterval(timer);
            const question = gameQuestions[currentQuestion];
            
            const options = document.querySelectorAll('.option-card');
            options.forEach((opt, index) => {
                if (index === question.correct) {
                    opt.classList.add('correct');
                } else {
                    const wasSelected = Object.values(answers).some(a => a.option === index);
                    if (wasSelected) {
                        opt.classList.add('incorrect');
                    }
                }
            });

            updateScoreboard();
            
            airconsole.broadcast({
                action: 'showAnswer',
                correctIndex: question.correct
            });

            setTimeout(() => {
                if (currentQuestion < gameQuestions.length - 1) {
                    currentQuestion++;
                    showQuestion();
                    airconsole.broadcast({ 
                        action: 'nextQuestion', 
                        question: { index: currentQuestion, total: gameQuestions.length }
                    });
                } else {
                    endGame();
                }
            }, 2500);
        }

        function updateScoreboard() {
            const list = document.getElementById('scoreboardList');
            list.innerHTML = '';
            
            const sortedPlayers = Object.values(players)
                .filter(p => !p.disconnected)
                .sort((a, b) => b.score - a.score);
            
            sortedPlayers.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = `scoreboard-item ${index === 0 ? 'first' : ''}`;
                item.innerHTML = `
                    <span>${player.emoji} ${player.name}</span>
                    <span>${player.score}</span>
                `;
                list.appendChild(item);
            });
            
            airconsole.broadcast({ action: 'leaderboardUpdate', players: sortedPlayers });
        }

        function endGame() {
            gameState = 'gameEnd';
            showScreen('end');
            
            const sortedPlayers = Object.values(players)
                .filter(p => !p.disconnected)
                .sort((a, b) => b.score - a.score);
            
            const winnerSection = document.getElementById('winnerSection');
            if (sortedPlayers.length > 0) {
                const winner = sortedPlayers[0];
                winnerSection.innerHTML = `
                    <div class="winner-crown">üëë</div>
                    <div class="winner-name">${winner.emoji} ${winner.name}</div>
                    <div class="winner-score">${winner.score} puntos</div>
                `;
                
                playSound('victory');
                createConfetti();
            }
            
            const podium = document.getElementById('podium');
            podium.innerHTML = '';
            
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            const classes = ['first', 'second', 'third'];
            
            sortedPlayers.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = `podium-item ${classes[index] || 'other'}`;
                item.innerHTML = `
                    <div class="podium-left">
                        <span class="podium-rank">${medals[index] || `#${index + 1}`}</span>
                        <span style="font-size: 1.5em;">${player.emoji}</span>
                        <span class="podium-name">${player.name}</span>
                    </div>
                    <span class="podium-score">${player.score} pts</span>
                `;
                podium.appendChild(item);
            });

            airconsole.broadcast({ 
                action: 'gameEnd', 
                winner: sortedPlayers[0],
                players: sortedPlayers
            });
        }

        function resetGame() {
            gameState = 'categorySelect';
            currentQuestion = 0;
            answers = {};
            clearInterval(timer);
            
            Object.keys(players).forEach(id => {
                players[id].score = 0;
            });
            
            showScreen('category');
            airconsole.broadcast({ action: 'reset', gameState: 'categorySelect' });
        }

        function showScreen(screen) {
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('active');
            });
            
            const targetScreen = document.getElementById(screen + 'Screen');
            if (targetScreen) {
                targetScreen.classList.add('active');
            }
        }

        window.onload = init;
    </script>
</body>
</html>
