<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEAM Trivia - Pantalla Principal</title>
    <script src="https://www.airconsole.com/api/airconsole-1.8.0.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            background: linear-gradient(180deg, #1B4D3E 0%, #0D2818 100%);
            min-height: 100vh;
            color: white;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* WAITING SCREEN */
        .screen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
        }

        .screen.active {
            display: flex;
        }

        /* HEADER */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            position: relative;
        }

        .timer-bar-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .timer-bar {
            width: 60%;
            height: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            overflow: visible;
            position: relative;
            border: 3px solid rgba(255, 255, 255, 0.2);
        }

        .timer-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #F4D03F 0%, #7CB342 50%, #43A047 100%);
            border-radius: 17px;
            transition: width 0.1s linear;
            position: relative;
            width: 100%;
        }

        .timer-bar-fill::after {
            content: '';
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid #43A047;
            border-top: 15px solid transparent;
            border-bottom: 15px solid transparent;
        }

        .timer-circle {
            width: 80px;
            height: 80px;
            background: #2196F3;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.5);
            border: 4px solid rgba(255, 255, 255, 0.3);
        }

        /* WAITING SCREEN */
        .waiting-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .logo-container {
            margin-bottom: 40px;
        }

        .logo {
            font-size: 4em;
            font-weight: 900;
            background: linear-gradient(45deg, #F4D03F, #FF6B6B, #4ECDC4, #45B7D1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            filter: drop-shadow(3px 3px 0px rgba(0,0,0,0.3));
        }

        .waiting-title {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #F4D03F;
        }

        .waiting-subtitle {
            font-size: 1.5em;
            opacity: 0.8;
            margin-bottom: 40px;
        }

        .players-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-bottom: 40px;
            max-width: 800px;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .player-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }

        .player-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            border: 3px solid white;
        }

        .player-name {
            font-size: 1.3em;
            font-weight: bold;
        }

        .player-status {
            color: #4CAF50;
            font-size: 0.9em;
        }

        .start-button {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 20px 60px;
            font-size: 1.5em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .start-button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.6);
        }

        .start-button:disabled {
            background: #666;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* CATEGORY SELECTION */
        .category-screen {
            padding: 40px;
        }

        .category-title {
            text-align: center;
            font-size: 2.5em;
            color: #F4D03F;
            margin-bottom: 40px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto 40px;
        }

        .category-card {
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-5px);
            border-color: #F4D03F;
        }

        .category-card.selected {
            background: rgba(244, 208, 63, 0.2);
            border-color: #F4D03F;
            box-shadow: 0 0 30px rgba(244, 208, 63, 0.3);
        }

        .category-emoji {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .category-name {
            font-size: 1.3em;
            font-weight: bold;
        }

        /* PLAYING SCREEN */
        .playing-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 0 40px 40px;
        }

        .question-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .question-number {
            font-size: 1.2em;
            color: #F4D03F;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .question-text {
            font-size: 2.5em;
            text-align: center;
            max-width: 900px;
            line-height: 1.4;
            margin-bottom: 50px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* OPTIONS GRID - ESTILO AIRCONSOLE */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            max-width: 1000px;
            width: 100%;
        }

        .option-card {
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .option-card:hover {
            transform: scale(1.02);
        }

        .option-letter {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }

        .option-card.option-a .option-letter { background: #8B9A46; }
        .option-card.option-b .option-letter { background: #C94C4C; }
        .option-card.option-c .option-letter { background: #4A8B8B; }
        .option-card.option-d .option-letter { background: #D4A44C; }

        .option-text {
            flex: 1;
            padding: 20px 25px;
            font-size: 1.4em;
            font-weight: 500;
        }

        .option-card.correct {
            background: #4CAF50;
            border-color: #81C784;
        }

        .option-card.incorrect {
            background: #f44336;
            border-color: #e57373;
        }

        .option-card.highlight {
            animation: pulse 0.5s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* FOOTER - PLAYERS STATUS */
        .game-footer {
            display: flex;
            align-items: center;
            padding: 20px 40px;
            gap: 20px;
        }

        .trivia-logo {
            width: 150px;
            height: 100px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .trivia-logo-text {
            font-size: 1.5em;
            font-weight: bold;
            color: #F4D03F;
            font-style: italic;
        }

        .trivia-logo::before {
            content: 'üèÜ';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
        }

        .trivia-logo::after {
            content: 'üöÄ';
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 1.2em;
        }

        .players-status {
            display: flex;
            gap: 15px;
            flex: 1;
        }

        .player-status-card {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 10px;
        }

        .player-status-icon {
            font-size: 1.5em;
        }

        .player-status-name {
            font-weight: bold;
        }

        .player-answered {
            color: #4CAF50;
        }

        .player-not-answered {
            color: #999;
        }

        .player-x {
            color: #f44336;
            font-size: 1.5em;
            margin-left: 10px;
        }

        /* RESULTS SCREEN */
        .results-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .results-answer {
            font-size: 1.8em;
            color: #4CAF50;
            margin-bottom: 30px;
        }

        .results-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 600px;
            width: 100%;
            margin-bottom: 40px;
        }

        .result-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
        }

        .result-item.correct-answer {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4CAF50;
        }

        .result-item.wrong-answer {
            background: rgba(244, 67, 54, 0.3);
            border: 2px solid #f44336;
        }

        .result-player {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .result-points {
            font-size: 1.5em;
            font-weight: bold;
        }

        .result-points.positive {
            color: #4CAF50;
        }

        .result-points.zero {
            color: #f44336;
        }

        /* END SCREEN */
        .end-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .end-title {
            font-size: 3em;
            color: #F4D03F;
            margin-bottom: 40px;
        }

        .podium {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 600px;
            width: 100%;
            margin-bottom: 40px;
        }

        .podium-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 25px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .podium-item:hover {
            transform: translateX(10px);
        }

        .podium-item.first {
            background: linear-gradient(135deg, #FFD700, #FFA000);
            color: #000;
        }

        .podium-item.second {
            background: linear-gradient(135deg, #C0C0C0, #A0A0A0);
            color: #000;
        }

        .podium-item.third {
            background: linear-gradient(135deg, #CD7F32, #8B4513);
            color: white;
        }

        .podium-item.other {
            background: rgba(255, 255, 255, 0.1);
        }

        .podium-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .podium-rank {
            font-size: 2em;
            font-weight: bold;
        }

        .podium-name {
            font-size: 1.5em;
            font-weight: bold;
        }

        .podium-score {
            font-size: 2em;
            font-weight: bold;
        }

        .replay-button {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            color: white;
            border: none;
            padding: 20px 60px;
            font-size: 1.5em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.4);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .replay-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(156, 39, 176, 0.6);
        }

        /* SCOREBOARD */
        .scoreboard {
            position: absolute;
            top: 120px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            min-width: 200px;
        }

        .scoreboard-title {
            font-size: 1.2em;
            color: #F4D03F;
            margin-bottom: 15px;
            text-align: center;
        }

        .scoreboard-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .scoreboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .scoreboard-item.highlight {
            background: rgba(244, 208, 63, 0.2);
            border: 1px solid #F4D03F;
        }

        .sound-toggle {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 2em;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .sound-toggle:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- WAITING SCREEN -->
        <div class="screen waiting-screen active" id="waitingScreen">
            <div class="waiting-content">
                <div class="logo-container">
                    <div class="logo">üéØ STEAM TRIVIA üéØ</div>
                </div>
                <h2 class="waiting-title">¬°Esperando Jugadores!</h2>
                <p class="waiting-subtitle">Escanea el c√≥digo QR con tu tel√©fono para unirte</p>
                <div class="players-grid" id="playersGrid"></div>
                <button class="start-button" id="startButton" disabled>Esperando jugadores...</button>
            </div>
        </div>

        <!-- CATEGORY SCREEN -->
        <div class="screen category-screen" id="categoryScreen">
            <h2 class="category-title">üéÆ Selecciona una Categor√≠a</h2>
            <div class="category-grid" id="categoryGrid"></div>
            <div style="text-align: center;">
                <button class="start-button" id="startGameButton">¬°INICIAR JUEGO!</button>
            </div>
        </div>

        <!-- PLAYING SCREEN -->
        <div class="screen playing-screen" id="playingScreen">
            <div class="game-header">
                <div class="timer-bar-container">
                    <div class="timer-bar">
                        <div class="timer-bar-fill" id="timerBarFill"></div>
                    </div>
                </div>
                <div class="timer-circle" id="timerCircle">20</div>
            </div>

            <div class="playing-content">
                <div class="question-section">
                    <div class="question-number" id="questionNumber">Pregunta 1 de 5</div>
                    <h2 class="question-text" id="questionText">¬øCu√°l es la capital de Francia?</h2>
                    <div class="options-grid" id="optionsGrid"></div>
                </div>
            </div>

            <div class="game-footer">
                <div class="trivia-logo">
                    <span class="trivia-logo-text">Trivia</span>
                </div>
                <div class="players-status" id="playersStatus"></div>
            </div>

            <div class="scoreboard" id="scoreboard">
                <div class="scoreboard-title">üèÜ Puntuaci√≥n</div>
                <div class="scoreboard-list" id="scoreboardList"></div>
            </div>
        </div>

        <!-- END SCREEN -->
        <div class="screen end-screen" id="endScreen">
            <div class="end-content">
                <h2 class="end-title">üèÜ ¬°Juego Terminado! üèÜ</h2>
                <div class="podium" id="podium"></div>
                <button class="replay-button" id="replayButton">üîÑ JUGAR DE NUEVO</button>
            </div>
        </div>

        <div class="sound-toggle" id="soundToggle">üîä</div>
    </div>

    <script>
        // Categor√≠as con preguntas
        const categories = {
            general: {
                name: "General",
                emoji: "üåç",
                questions: [
                    { question: "¬øCu√°l es la capital de Francia?", options: ["Londres", "Par√≠s", "Berl√≠n", "Madrid"], correct: 1 },
                    { question: "¬øEn qu√© a√±o lleg√≥ el hombre a la Luna?", options: ["1965", "1969", "1972", "1975"], correct: 1 },
                    { question: "¬øQui√©n pint√≥ la Mona Lisa?", options: ["Picasso", "Van Gogh", "Leonardo da Vinci", "Miguel √Ångel"], correct: 2 },
                    { question: "¬øCu√°l es el oc√©ano m√°s grande del mundo?", options: ["Atl√°ntico", "√çndico", "√Årtico", "Pac√≠fico"], correct: 3 },
                    { question: "¬øCu√°ntos continentes hay en la Tierra?", options: ["5", "6", "7", "8"], correct: 2 },
                    { question: "¬øCu√°l es el animal terrestre m√°s r√°pido?", options: ["Le√≥n", "Tigre", "Guepardo", "Leopardo"], correct: 2 },
                    { question: "¬øQu√© instrumento mide la temperatura?", options: ["Bar√≥metro", "Term√≥metro", "Higr√≥metro", "Anem√≥metro"], correct: 1 },
                    { question: "¬øCu√°ntos colores tiene el arco iris?", options: ["5", "6", "7", "8"], correct: 2 },
                    { question: "¬øCu√°l es el metal m√°s abundante en la corteza terrestre?", options: ["Hierro", "Aluminio", "Cobre", "Oro"], correct: 1 },
                    { question: "¬øQu√© gas respiramos principalmente?", options: ["Ox√≠geno", "Nitr√≥geno", "Di√≥xido de carbono", "Helio"], correct: 0 }
                ]
            },
            science: {
                name: "Ciencia",
                emoji: "üî¨",
                questions: [
                    { question: "¬øCu√°l es el elemento qu√≠mico del oro?", options: ["Go", "Gd", "Au", "Ag"], correct: 2 },
                    { question: "¬øQu√© planeta es el m√°s cercano al Sol?", options: ["Venus", "Mercurio", "Marte", "Tierra"], correct: 1 },
                    { question: "¬øCu√°ntos huesos tiene el cuerpo humano adulto?", options: ["196", "206", "216", "226"], correct: 1 },
                    { question: "¬øQu√© velocidad lleva la luz?", options: ["300,000 km/s", "150,000 km/s", "500,000 km/s", "100,000 km/s"], correct: 0 },
                    { question: "¬øCu√°l es el animal m√°s grande del mundo?", options: ["Elefante", "Tibur√≥n blanco", "Ballena azul", "Jirafa"], correct: 2 },
                    { question: "¬øCu√°l es el proceso por el que las plantas hacen su comida?", options: ["Respiraci√≥n", "Fotos√≠ntesis", "Transpiraci√≥n", "Germinaci√≥n"], correct: 1 },
                    { question: "¬øQu√© tipo de sangre es universal como donante?", options: ["A", "B", "AB", "O"], correct: 3 },
                    { question: "¬øCu√°ntos sentidos tiene el ser humano?", options: ["3", "4", "5", "6"], correct: 2 },
                    { question: "¬øQu√© √≥rgano bombea la sangre en el cuerpo?", options: ["Pulmones", "H√≠gado", "Coraz√≥n", "Ri√±ones"], correct: 2 },
                    { question: "¬øCu√°l es la galaxia en la que vivimos?", options: ["Andr√≥meda", "V√≠a L√°ctea", "Sombrero", "Tri√°ngulo"], correct: 1 }
                ]
            },
            mathematics: {
                name: "Matem√°ticas",
                emoji: "üìê",
                questions: [
                    { question: "¬øCu√°nto es 2 + 2 √ó 3?", options: ["12", "8", "10", "6"], correct: 1 },
                    { question: "¬øCu√°l es la ra√≠z cuadrada de 144?", options: ["10", "11", "12", "13"], correct: 2 },
                    { question: "¬øQu√© teorema relaciona los lados de un tri√°ngulo rect√°ngulo?", options: ["Pit√°goras", "Euclides", "Arqu√≠medes", "Gauss"], correct: 0 },
                    { question: "¬øCu√°ntos grados tiene un tri√°ngulo?", options: ["180¬∞", "360¬∞", "90¬∞", "270¬∞"], correct: 0 },
                    { question: "¬øCu√°l es el n√∫mero œÄ (pi) aproximadamente?", options: ["2.14", "3.14", "4.14", "5.14"], correct: 1 },
                    { question: "¬øCu√°nto es el 25% de 200?", options: ["25", "50", "75", "100"], correct: 1 },
                    { question: "¬øCu√°l es el √°rea de un c√≠rculo con radio 5?", options: ["25œÄ", "10œÄ", "5œÄ", "20œÄ"], correct: 0 },
                    { question: "¬øQu√© n√∫mero es primo?", options: ["4", "6", "9", "7"], correct: 3 },
                    { question: "¬øCu√°ntos lados tiene un hex√°gono?", options: ["4", "5", "6", "7"], correct: 2 },
                    { question: "¬øCu√°l es el valor de x en 2x + 3 = 7?", options: ["1", "2", "3", "4"], correct: 1 }
                ]
            },
            robotics: {
                name: "Rob√≥tica",
                emoji: "ü§ñ",
                questions: [
                    { question: "¬øQu√© significa 'AI' en rob√≥tica?", options: ["Automated Intelligence", "Artificial Intelligence", "Advanced Integration", "Automatic Interface"], correct: 1 },
                    { question: "¬øCu√°l es el primer robot humanoide famoso?", options: ["Asimo", "Roomba", "Boston Dynamics", "Pepper"], correct: 0 },
                    { question: "¬øQu√© sensor se usa para detectar obst√°culos?", options: ["GPS", "Ultrasonido", "Bluetooth", "WiFi"], correct: 1 },
                    { question: "¬øQu√© lenguaje se usa com√∫nmente en Arduino?", options: ["Python", "Java", "C/C++", "JavaScript"], correct: 2 },
                    { question: "¬øQu√© es un actuador en rob√≥tica?", options: ["Sensor", "Motor", "Bater√≠a", "Procesador"], correct: 1 },
                    { question: "¬øQu√© componente procesa la informaci√≥n en un robot?", options: ["Bater√≠a", "Sensor", "Microcontrolador", "Motor"], correct: 2 },
                    { question: "¬øQu√© es ROS en rob√≥tica?", options: ["Robot Operating System", "Robotic Output System", "Remote Operation Software", "Robot Optimization Suite"], correct: 0 },
                    { question: "¬øQu√© tipo de robot es Roomba?", options: ["Humanoide", "Aspirador", "Industrial", "Militar"], correct: 1 },
                    { question: "¬øQu√© significa 'IoT' en rob√≥tica?", options: ["Internet of Things", "Input of Technology", "Intelligent Operations Team", "Integrated Output Terminal"], correct: 0 },
                    { question: "¬øQu√© robot gan√≥ las World Robot Soccer Cup?", options: ["Asimo", "NAO", "Pepper", "Spot"], correct: 1 }
                ]
            },
            chemistry: {
                name: "Qu√≠mica",
                emoji: "‚öóÔ∏è",
                questions: [
                    { question: "¬øCu√°l es el s√≠mbolo del elemento ox√≠geno?", options: ["Ox", "O2", "O", "Ox2"], correct: 2 },
                    { question: "¬øCu√°ntos elementos hay en la tabla peri√≥dica?", options: ["108", "118", "128", "138"], correct: 1 },
                    { question: "¬øQu√© tipo de enlace tiene el agua?", options: ["I√≥nico", "Met√°lico", "Covalente", "Hidr√≥geno"], correct: 2 },
                    { question: "¬øCu√°l es la f√≥rmula del di√≥xido de carbono?", options: ["CO", "CO2", "C2O", "C2O2"], correct: 1 },
                    { question: "¬øQu√© pH tiene una sustancia neutra?", options: ["0", "7", "14", "10"], correct: 1 },
                    { question: "¬øCu√°l es el elemento m√°s abundante en el universo?", options: ["Ox√≠geno", "Carbono", "Hidr√≥geno", "Helio"], correct: 2 },
                    { question: "¬øQu√© es la tabla peri√≥dica?", options: ["Tabla de multiplicar", "Organizaci√≥n de elementos", "Tabla de reacciones", "Lista de compuestos"], correct: 1 },
                    { question: "¬øCu√°l es la f√≥rmula qu√≠mica del agua?", options: ["H2", "O2", "H2O", "HO"], correct: 2 },
                    { question: "¬øQu√© gas hace que las bebidas efervescan?", options: ["Ox√≠geno", "Nitr√≥geno", "Di√≥xido de carbono", "Helio"], correct: 2 },
                    { question: "¬øQu√© tipo de reacci√≥n libera energ√≠a?", options: ["Endot√©rmica", "Exot√©rmica", "Catal√≠tica", "Reversible"], correct: 1 }
                ]
            },
            technology: {
                name: "Tecnolog√≠a",
                emoji: "üíª",
                questions: [
                    { question: "¬øQu√© significa 'www' en una direcci√≥n web?", options: ["World Wide Web", "World Web Way", "Wide World Web", "Web World Wide"], correct: 0 },
                    { question: "¬øCu√°l fue el primer lenguaje de programaci√≥n?", options: ["COBOL", "FORTRAN", "Assembly", "Plankalk√ºl"], correct: 3 },
                    { question: "¬øQu√© compa√±√≠a cre√≥ el sistema operativo Android?", options: ["Apple", "Microsoft", "Google", "Samsung"], correct: 2 },
                    { question: "¬øQu√© es un algoritmo?", options: ["Un virus inform√°tico", "Un conjunto de instrucciones", "Un tipo de memoria", "Un lenguaje de programaci√≥n"], correct: 1 },
                    { question: "¬øQu√© significa 'CPU' en computadoras?", options: ["Central Processing Unit", "Computer Power Unit", "Control Processing Unit", "Central Power Unit"], correct: 0 },
                    { question: "¬øQu√© significa 'HTML'?", options: ["HyperText Markup Language", "High Tech Machine Learning", "Home Tool Management List", "Hyper Transfer Media Link"], correct: 0 },
                    { question: "¬øQu√© compa√±√≠a cre√≥ Windows?", options: ["Apple", "Google", "Microsoft", "IBM"], correct: 2 },
                    { question: "¬øQu√© es un 'bit' en computaci√≥n?", options: ["Unidad de memoria", "Unidad de informaci√≥n binaria", "Unidad de velocidad", "Unidad de energ√≠a"], correct: 1 },
                    { question: "¬øQu√© significa 'IoT'?", options: ["Internet of Things", "Input Output Terminal", "Interactive Online Technology", "Integrated Operating System"], correct: 0 },
                    { question: "¬øQu√© lenguaje se usa principalmente para desarrollo web?", options: ["Python", "Java", "JavaScript", "C++"], correct: 2 }
                ]
            },
            history: {
                name: "Historia",
                emoji: "üìú",
                questions: [
                    { question: "¬øEn qu√© a√±o cay√≥ el Imperio Romano de Occidente?", options: ["410", "476", "500", "600"], correct: 1 },
                    { question: "¬øQui√©n fue el primer presidente de Estados Unidos?", options: ["Thomas Jefferson", "Abraham Lincoln", "George Washington", "John Adams"], correct: 2 },
                    { question: "¬øD√≥nde comenz√≥ la Revoluci√≥n Industrial?", options: ["Francia", "Alemania", "Inglaterra", "Italia"], correct: 2 },
                    { question: "¬øQu√© civilizaci√≥n construy√≥ las pir√°mides de Giza?", options: ["Griega", "Egipcia", "Romana", "Maya"], correct: 1 },
                    { question: "¬øEn qu√© a√±o termin√≥ la Segunda Guerra Mundial?", options: ["1943", "1944", "1945", "1946"], correct: 2 },
                    { question: "¬øQu√© evento marc√≥ el fin de la Edad Media?", options: ["Descubrimiento de Am√©rica", "Ca√≠da de Constantinopla", "Revoluci√≥n Francesa", "Guerra de los Cien A√±os"], correct: 1 },
                    { question: "¬øQui√©n fue Cleopatra?", options: ["Reina de Egipto", "Emperatriz romana", "Filosofa griega", "Pintora italiana"], correct: 0 },
                    { question: "¬øEn qu√© a√±o lleg√≥ Col√≥n a Am√©rica?", options: ["1492", "1500", "1510", "1520"], correct: 0 },
                    { question: "¬øQu√© imperio conquist√≥ M√©xico en 1521?", options: ["Espa√±ol", "Portugu√©s", "Franc√©s", "Ingl√©s"], correct: 0 },
                    { question: "¬øQui√©n pint√≥ la Capilla Sixtina?", options: ["Leonardo da Vinci", "Miguel √Ångel", "Rafael", "Donatello"], correct: 1 }
                ]
            },
            geography: {
                name: "Geograf√≠a",
                emoji: "üó∫Ô∏è",
                questions: [
                    { question: "¬øCu√°l es el r√≠o m√°s largo del mundo?", options: ["Amazonas", "Nilo", "Yangts√©", "Misisipi"], correct: 1 },
                    { question: "¬øCu√°ntos pa√≠ses hay en el mundo?", options: ["190", "195", "200", "205"], correct: 1 },
                    { question: "¬øCu√°l es la monta√±a m√°s alta del mundo?", options: ["K2", "Kangchenjunga", "Everest", "Makalu"], correct: 2 },
                    { question: "¬øQu√© oc√©ano est√° al este de √Åfrica?", options: ["Atl√°ntico", "Pac√≠fico", "√çndico", "√Årtico"], correct: 2 },
                    { question: "¬øCu√°l es la capital de Australia?", options: ["S√≠dney", "Melbourne", "Canberra", "Brisbane"], correct: 2 },
                    { question: "¬øCu√°l es el desierto m√°s grande del mundo?", options: ["Sahara", "Gobi", "Ant√°rtico", "Arabia"], correct: 0 },
                    { question: "¬øQu√© pa√≠s tiene m√°s islas en el mundo?", options: ["Filipinas", "Indonesia", "Suecia", "Jap√≥n"], correct: 2 },
                    { question: "¬øCu√°l es el lago m√°s profundo del mundo?", options: ["Titicaca", "Baikal", "Superior", "Victoria"], correct: 1 },
                    { question: "¬øQu√© continente es el m√°s peque√±o?", options: ["Europa", "Ocean√≠a", "Ant√°rtida", "Am√©rica"], correct: 1 },
                    { question: "¬øCu√°l es la capital de Canad√°?", options: ["Toronto", "Vancouver", "Montreal", "Ottawa"], correct: 3 }
                ]
            }
        };

        const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2'];
        
        let airconsole;
        let players = {};
        let gameState = 'waiting';
        let currentQuestion = 0;
        let gameQuestions = [];
        let questionStartTime = 0;
        let answers = {};
        let selectedCategory = 'general';
        let timer = null;
        let timeLeft = 20;
        let soundEnabled = true;

        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (!soundEnabled) return;
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'join') {
                oscillator.frequency.value = 523.25;
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'correct') {
                const notes = [659.25, 783.99, 1046.5];
                notes.forEach((freq, i) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.2);
                    osc.start(audioContext.currentTime + i * 0.1);
                    osc.stop(audioContext.currentTime + i * 0.1 + 0.2);
                });
            } else if (type === 'wrong') {
                oscillator.frequency.value = 200;
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            } else if (type === 'tick') {
                oscillator.frequency.value = 800;
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.05);
            }
        }

        function init() {
            airconsole = new AirConsole();

            airconsole.onReady = function() {
                console.log('AirConsole ready');
                setupCategories();
            };

            airconsole.onDisconnect = function(deviceId) {
                if (players[deviceId]) {
                    delete players[deviceId];
                    updatePlayersDisplay();
                }
            };

            airconsole.onMessage = function(deviceId, data) {
                console.log("Screen received:", data.action, data);
                
                if (data.action === 'join') {
                    const isAdmin = Object.keys(players).length === 0;
                    players[deviceId] = {
                        id: deviceId,
                        name: data.name,
                        emoji: data.emoji,
                        score: 0,
                        color: colors[Object.keys(players).length % colors.length],
                        isAdmin: isAdmin
                    };
                    
                    playSound('join');
                    updatePlayersDisplay();
                    
                    airconsole.message(deviceId, { 
                        action: 'joined', 
                        color: players[deviceId].color,
                        emoji: data.emoji,
                        isAdmin: isAdmin
                    });
                    
                    if (isAdmin) {
                        showScreen('category');
                    }
                } else if (data.action === 'selectCategory' && players[deviceId]?.isAdmin) {
                    selectedCategory = data.category;
                    document.querySelectorAll('.category-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    document.querySelector(`[data-category="${data.category}"]`)?.classList.add('selected');
                } else if (data.action === 'answer' && gameState === 'playing') {
                    handleAnswer(deviceId, data.option, data.timestamp);
                } else if (data.action === 'start' && gameState === 'waiting') {
                    startGame();
                }
            };

            document.getElementById('startButton').addEventListener('click', () => {
                if (Object.keys(players).length > 0) {
                    showScreen('category');
                }
            });
            document.getElementById('startGameButton').addEventListener('click', startGame);
            document.getElementById('replayButton').addEventListener('click', resetGame);
            document.getElementById('soundToggle').addEventListener('click', toggleSound);
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').textContent = soundEnabled ? 'üîä' : 'üîá';
        }

        function setupCategories() {
            const grid = document.getElementById('categoryGrid');
            grid.innerHTML = '';
            Object.entries(categories).forEach(([key, category]) => {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.dataset.category = key;
                card.innerHTML = `
                    <div class="category-emoji">${category.emoji}</div>
                    <div class="category-name">${category.name}</div>
                `;
                card.addEventListener('click', () => {
                    document.querySelectorAll('.category-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    selectedCategory = key;
                    airconsole.broadcast({ action: 'selectCategory', category: key });
                });
                grid.appendChild(card);
            });
            document.querySelector('.category-card')?.classList.add('selected');
        }

        function updatePlayersDisplay() {
            const grid = document.getElementById('playersGrid');
            grid.innerHTML = '';
            
            Object.values(players).forEach(player => {
                const card = document.createElement('div');
                card.className = 'player-card';
                card.innerHTML = `
                    <div class="player-avatar" style="background-color: ${player.color}">${player.emoji}</div>
                    <div>
                        <div class="player-name">${player.name}</div>
                        <div class="player-status">${player.isAdmin ? 'üëë Admin' : '‚úì Conectado'}</div>
                    </div>
                `;
                grid.appendChild(card);
            });

            const startButton = document.getElementById('startButton');
            if (Object.keys(players).length >= 1) {
                startButton.disabled = false;
                startButton.textContent = '¬°INICIAR JUEGO!';
            } else {
                startButton.disabled = true;
                startButton.textContent = 'Esperando jugadores...';
            }

            // Update players status in footer
            updatePlayersStatus();
        }

        function updatePlayersStatus() {
            const container = document.getElementById('playersStatus');
            if (!container) return;
            container.innerHTML = '';
            
            Object.values(players).forEach(player => {
                const hasAnswered = answers[player.id] !== undefined;
                const card = document.createElement('div');
                card.className = 'player-status-card';
                card.innerHTML = `
                    <span class="player-status-icon">${player.emoji}</span>
                    <span class="player-status-name ${hasAnswered ? 'player-answered' : 'player-not-answered'}">${player.name}</span>
                    ${hasAnswered ? '<span style="color: #4CAF50;">‚úì</span>' : '<span class="player-x">‚úó</span>'}
                `;
                container.appendChild(card);
            });
        }

        function startGame() {
            if (Object.keys(players).length === 0) {
                // Demo mode
                players['demo1'] = { id: 'demo1', name: 'Demo', emoji: 'üéÆ', score: 0, color: colors[0], isAdmin: true };
            }

            gameState = 'playing';
            currentQuestion = 0;
            
            const category = categories[selectedCategory];
            gameQuestions = [...category.questions].sort(() => Math.random() - 0.5).slice(0, 5);
            
            Object.keys(players).forEach(id => {
                players[id].score = 0;
            });

            showScreen('playing');
            showQuestion();
            
            airconsole.broadcast({ 
                action: 'gameStart', 
                question: { index: currentQuestion, total: gameQuestions.length }
            });
        }

        function showQuestion() {
            answers = {};
            questionStartTime = Date.now();
            timeLeft = 20;
            
            const question = gameQuestions[currentQuestion];
            document.getElementById('questionNumber').textContent = `Pregunta ${currentQuestion + 1} de ${gameQuestions.length}`;
            document.getElementById('questionText').textContent = question.question;
            
            displayOptions(question);
            updatePlayersStatus();
            updateScoreboard();
            startTimer();
        }

        function displayOptions(question) {
            const container = document.getElementById('optionsGrid');
            container.innerHTML = '';
            
            const letters = ['A', 'B', 'C', 'D'];
            const classes = ['option-a', 'option-b', 'option-c', 'option-d'];
            
            question.options.forEach((option, index) => {
                const card = document.createElement('div');
                card.className = `option-card ${classes[index]}`;
                card.dataset.index = index;
                card.innerHTML = `
                    <div class="option-letter">${letters[index]}</div>
                    <div class="option-text">${option}</div>
                `;
                container.appendChild(card);
            });
        }

        function startTimer() {
            clearInterval(timer);
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 5) {
                    playSound('tick');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    showResults();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            document.getElementById('timerCircle').textContent = timeLeft;
            const percentage = (timeLeft / 20) * 100;
            document.getElementById('timerBarFill').style.width = `${percentage}%`;
            
            if (timeLeft <= 5) {
                document.getElementById('timerCircle').style.background = '#f44336';
            } else if (timeLeft <= 10) {
                document.getElementById('timerCircle').style.background = '#FF9800';
            } else {
                document.getElementById('timerCircle').style.background = '#2196F3';
            }
        }

        function handleAnswer(playerId, optionIndex, timestamp) {
            if (answers[playerId]) return;

            const timeElapsed = timestamp - questionStartTime;
            const isCorrect = optionIndex === gameQuestions[currentQuestion].correct;

            answers[playerId] = {
                option: optionIndex,
                correct: isCorrect,
                time: timeElapsed
            };

            if (isCorrect) {
                const points = Math.max(100, Math.floor(1000 - (timeElapsed / 20)));
                players[playerId].score += points;
                playSound('correct');
                
                airconsole.message(playerId, { 
                    action: 'result', 
                    correct: true, 
                    points: points
                });
            } else {
                playSound('wrong');
                airconsole.message(playerId, { 
                    action: 'result', 
                    correct: false, 
                    points: 0
                });
            }

            updatePlayersStatus();

            if (Object.keys(answers).length >= Object.keys(players).length) {
                clearInterval(timer);
                setTimeout(() => showResults(), 1000);
            }
        }

        function showResults() {
            clearInterval(timer);
            const question = gameQuestions[currentQuestion];
            
            // Highlight correct answer
            const options = document.querySelectorAll('.option-card');
            options.forEach((opt, index) => {
                if (index === question.correct) {
                    opt.classList.add('correct');
                } else {
                    const wasSelected = Object.values(answers).some(a => a.option === index);
                    if (wasSelected) {
                        opt.classList.add('incorrect');
                    }
                }
            });

            updateScoreboard();

            setTimeout(() => {
                if (currentQuestion < gameQuestions.length - 1) {
                    currentQuestion++;
                    showQuestion();
                    airconsole.broadcast({ 
                        action: 'nextQuestion', 
                        question: { index: currentQuestion, total: gameQuestions.length }
                    });
                } else {
                    endGame();
                }
            }, 3000);
        }

        function updateScoreboard() {
            const list = document.getElementById('scoreboardList');
            list.innerHTML = '';
            
            const sortedPlayers = Object.values(players).sort((a, b) => b.score - a.score);
            
            sortedPlayers.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = `scoreboard-item ${index === 0 ? 'highlight' : ''}`;
                item.innerHTML = `
                    <span>${player.emoji} ${player.name}</span>
                    <span>${player.score}</span>
                `;
                list.appendChild(item);
            });
            
            airconsole.broadcast({ action: 'leaderboardUpdate', players: sortedPlayers });
        }

        function endGame() {
            gameState = 'gameEnd';
            showScreen('end');
            
            const podium = document.getElementById('podium');
            podium.innerHTML = '';
            
            const sortedPlayers = Object.values(players).sort((a, b) => b.score - a.score);
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            const classes = ['first', 'second', 'third'];
            
            sortedPlayers.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = `podium-item ${classes[index] || 'other'}`;
                item.innerHTML = `
                    <div class="podium-left">
                        <span class="podium-rank">${medals[index] || `#${index + 1}`}</span>
                        <span style="font-size: 2em;">${player.emoji}</span>
                        <span class="podium-name">${player.name}</span>
                    </div>
                    <span class="podium-score">${player.score} pts</span>
                `;
                podium.appendChild(item);
            });

            airconsole.broadcast({ 
                action: 'gameEnd', 
                winner: sortedPlayers[0],
                players: sortedPlayers
            });
        }

        function resetGame() {
            gameState = 'waiting';
            currentQuestion = 0;
            answers = {};
            clearInterval(timer);
            
            Object.keys(players).forEach(id => {
                players[id].score = 0;
            });
            
            showScreen('waiting');
            updatePlayersDisplay();
            airconsole.broadcast({ action: 'reset' });
        }

        function showScreen(screen) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screen + 'Screen').classList.add('active');
        }

        window.onload = init;
    </script>
</body>
</html>
