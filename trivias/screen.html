<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEAM Trivia - Fundacion STEAM RD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.airconsole.com/api/airconsole-1.8.0.js"></script>
    <script type="module">
        // Import Anime.js v4 from esm.sh
        import { animate, stagger } from 'https://esm.sh/animejs';
        window.anime = { animate, stagger };
        console.log('Anime.js v4 loaded from esm.sh');
    </script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        steam: {
                            turquesa: '#0595AE',
                            morado: '#AB3D8B',
                            naranja: '#EB8225',
                            verde: '#73A03F',
                            negro: '#010101',
                            blanco: '#FFFFFF'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body {
            transition: background 0.5s ease;
        }

        /* Category backgrounds - Clean white with colored particles */
        body.cat-general,
        body.cat-science,
        body.cat-mathematics,
        body.cat-robotics,
        body.cat-chemistry,
        body.cat-technology,
        body.cat-history,
        body.cat-geography,
        body.cat-default { 
            background: #FFFFFF;
            position: relative;
        }

        /* Animated background particles - Soft colored blobs */
        .bg-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 0;
        }

        .particle {
            position: absolute;
            opacity: 0.15;
            animation: floatParticle 25s infinite ease-in-out;
            will-change: transform;
            border-radius: 50%;
            filter: blur(40px);
        }

        .particle.icon-particle {
            font-size: clamp(2rem, 5vw, 3.5rem);
            opacity: 0.6;
        }

        @keyframes floatParticle {
            0%, 100% { 
                transform: translate(0, 0) scale(1); 
                opacity: 0.15;
            }
            25% { 
                transform: translate(50px, -50px) scale(1.2); 
                opacity: 0.25;
            }
            50% { 
                transform: translate(0, -100px) scale(1); 
                opacity: 0.15;
            }
            75% { 
                transform: translate(-50px, -50px) scale(1.2); 
                opacity: 0.25;
            }
        }

        /* Animated grid background - Subtle */
        .grid-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(5, 149, 174, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(5, 149, 174, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: 0;
        }

        /* Wavy lines background */
        .wavy-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            pointer-events: none;
            z-index: 0;
        }

        .wavy-bg path {
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
            animation: wavyMove 8s ease-in-out infinite;
        }

        @keyframes wavyMove {
            0%, 100% { d: path('M0,50 Q25,25 50,50 T100,50'); }
            50% { d: path('M0,50 Q25,75 50,50 T100,50'); }
        }

        /* Category icon animations */
        .category-icon {
            font-size: clamp(2.5rem, 6vw, 4rem);
            display: inline-block;
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .category-card {
            position: relative;
            overflow: hidden;
            background: white;
            border: 3px solid #E0E0E0;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.5) 50%,
                transparent 70%
            );
            transform: rotate(45deg);
            animation: shine 4s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .category-card:hover {
            transform: translateY(-4px);
            border-color: #0595AE;
            box-shadow: 0 8px 24px rgba(5, 149, 174, 0.2);
        }

        .category-card:hover .category-icon {
            transform: scale(1.1);
        }

        .category-card.selected {
            border-color: #73A03F;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            box-shadow: 0 4px 20px rgba(115, 160, 63, 0.3);
        }

        .category-card.selected .category-icon {
            animation: iconFloat 2s ease-in-out infinite;
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Glow effect */
        .glow {
            position: relative;
        }

        .glow::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .glow:hover::after {
            opacity: 0.5;
        }

        /* Power-up effect */
        @keyframes powerUp {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .power-up {
            animation: powerUp 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        /* Removed neon text effects - replaced with clean styles */

        /* Star burst effect */
        .star-burst {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            animation: burst 1s ease-out forwards;
        }

        @keyframes burst {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(20); opacity: 0; }
        }

        .screen {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .screen.active {
            display: flex;
            opacity: 1;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .logo-gradient {
            background: linear-gradient(45deg, #0595AE, #AB3D8B, #EB8225, #73A03F);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientMove 3s ease infinite;
        }

        @keyframes floatUp {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .float-up {
            animation: floatUp 0.8s ease-out forwards;
            display: block;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        .pulse-anim {
            animation: pulse 2s ease infinite;
            display: inline-block;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        .timer-warning { animation: pulse 0.5s ease infinite; }
        .timer-danger { animation: shake 0.3s ease infinite; }

        @keyframes correctPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .option-correct { animation: correctPop 0.3s ease; }
        .option-incorrect { animation: incorrectShake 0.3s ease; }

        @keyframes winnerBounce {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .winner-bounce { animation: winnerBounce 0.5s ease; }

        @keyframes confettiFall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confettiFall 3s ease-out forwards;
            will-change: transform;
        }

        /* Player avatar visual - responsive */
        .player-avatar-visual {
            width: clamp(35px, 5vw, 50px);
            height: clamp(35px, 5vw, 50px);
            border-radius: clamp(7px, 1vw, 11px);
            position: relative;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .player-avatar-visual::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            right: 3px;
            height: clamp(7px, 1vw, 11px);
            background: rgba(255,255,255,0.35);
            border-radius: 6px 6px 0 0;
        }

        .player-avatar-visual-large {
            width: clamp(45px, 7vw, 70px);
            height: clamp(45px, 7vw, 70px);
            border-radius: clamp(9px, 1.5vw, 14px);
        }

        .player-avatar-visual-large::before {
            height: clamp(9px, 1.5vw, 14px);
            top: 4px;
            left: 4px;
            right: 4px;
            border-radius: 8px 8px 0 0;
        }

        .player-avatar-visual-small {
            width: clamp(24px, 3vw, 36px);
            height: clamp(24px, 3vw, 36px);
            border-radius: clamp(5px, 0.8vw, 8px);
        }

        .player-avatar-visual-small::before {
            height: clamp(5px, 0.8vw, 8px);
            top: 2px;
            left: 2px;
            right: 2px;
            border-radius: 4px 4px 0 0;
        }

        /* Responsive text */
        .responsive-title {
            font-size: clamp(1.5rem, 5vw, 3.5rem);
        }

        .responsive-question {
            font-size: clamp(1rem, 3vw, 2.2rem);
        }

        /* Intro logo animation */
        @keyframes logoScale {
            0% { transform: scale(0.5) rotate(-5deg); opacity: 0; }
            60% { transform: scale(1.05) rotate(2deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .logo-intro {
            animation: logoScale 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes slideInFromBottom {
            0% { transform: translateY(50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .slide-in-bottom {
            animation: slideInFromBottom 0.8s ease-out forwards;
        }

        @keyframes shimmer {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .shimmer-text {
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        @keyframes loadingShine {
            0% { left: -100%; }
            100% { left: 200%; }
        }

        @keyframes loadingGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(115, 160, 63, 0.5); }
            50% { box-shadow: 0 0 20px rgba(115, 160, 63, 0.8), 0 0 30px rgba(115, 160, 63, 0.4); }
        }

        .loading-bar {
            width: 100%;
            position: relative;
            animation: loadingGlow 2s ease-in-out infinite;
        }

        .loading-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            animation: loadingShine 1.5s infinite;
        }

        .loading-text {
            animation: loadingPulse 1.5s ease-in-out infinite;
        }

        /* Intro screen - clean white background */
        
        /* Glassmorphism card - Clean style */
        .intro-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 2px solid transparent;
            border-radius: clamp(32px, 8vw, 56px);
            padding: clamp(32px, 8vw, 64px);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.08),
                0 8px 24px rgba(0, 0, 0, 0.04);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        /* Animated border - Simplified */
        .intro-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, 
                #AB3D8B 0%, 
                #0595AE 100%);
            border-radius: clamp(32px, 8vw, 56px);
            z-index: -1;
            opacity: 0.3;
        }
        
        /* Shimmer effect - Subtle */
        .intro-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent 40%, 
                rgba(255, 255, 255, 0.3) 50%, 
                transparent 60%);
            animation: shimmer 8s linear infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .intro-card:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.12),
                0 12px 32px rgba(0, 0, 0, 0.06);
        }
        
        /* Canvas for animated icon network */
        #particleCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .education-icon {
            font-size: clamp(3rem, 8vw, 5rem);
            display: inline-block;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15));
            cursor: pointer;
            position: relative;
        }

        .education-icon:hover {
            transform: scale(1.3) translateY(-12px) rotate(8deg);
            filter: drop-shadow(0 8px 20px rgba(0, 0, 0, 0.25));
        }
        
        .education-icon::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 150%;
            height: 150%;
            border-radius: 50%;
            background: currentColor;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
            transition: all 0.3s ease;
            z-index: -1;
            filter: blur(20px);
        }
        
        .education-icon:hover::before {
            opacity: 0.15;
            transform: translate(-50%, -50%) scale(1.3);
        }
        
        @keyframes iconFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-25px) rotate(-5deg); }
            50% { transform: translateY(0px) rotate(0deg); }
            75% { transform: translateY(-25px) rotate(5deg); }
        }
        
        .intro-edu-icon {
            animation: iconFloat 6s ease-in-out infinite;
        }
        
        .intro-edu-icon:nth-child(1) { animation-delay: 0s; }
        .intro-edu-icon:nth-child(2) { animation-delay: 0.5s; }
        .intro-edu-icon:nth-child(3) { animation-delay: 1s; }
        .intro-edu-icon:nth-child(4) { animation-delay: 1.5s; }
        .intro-edu-icon:nth-child(5) { animation-delay: 2s; }
        .intro-edu-icon:nth-child(6) { animation-delay: 2.5s; }
        .intro-edu-icon:nth-child(7) { animation-delay: 3s; }

        /* Removed old bounce-in animation - using Anime.js instead */

        .intro-title {
            font-family: 'Segoe UI', 'Arial Rounded MT Bold', sans-serif;
            font-weight: 900;
            letter-spacing: -0.02em;
        }

        /* Logo animation - Gaming style */
        .intro-logo {
            transition: all 0.3s ease;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.1));
        }
        
        .intro-logo:hover {
            transform: scale(1.08) rotate(3deg);
            filter: drop-shadow(0 6px 16px rgba(0, 0, 0, 0.15));
        }
        
        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-12px) rotate(-2deg); }
            50% { transform: translateY(0px) rotate(0deg); }
            75% { transform: translateY(-12px) rotate(2deg); }
        }
        
        .intro-logo img {
            animation: logoFloat 4s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .float-icon {
            animation: float 3s ease-in-out infinite;
        }

        .intro-card {
            background: white;
            border-radius: clamp(24px, 6vw, 40px);
            padding: clamp(32px, 8vw, 56px);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.08),
                0 4px 12px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: visible;
            transition: all 0.4s ease;
        }
        
        .intro-card:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.12),
                0 8px 20px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="cat-default font-sans text-steam-negro overflow-hidden">
    <div class="w-screen h-screen flex flex-col relative">
        <!-- INTRO SCREEN -->
        <div class="screen intro-screen active flex-col items-center justify-center p-4 sm:p-6 lg:p-10 bg-white min-h-screen relative overflow-hidden" id="introScreen">
            <!-- Background Icons Pattern -->
            <div class="absolute inset-0 grid grid-cols-8 grid-rows-6 gap-8 p-8 opacity-10" style="z-index: 0;">
                <iconify-icon icon="mdi:math-compass" style="font-size: 3rem; color: #0595AE;"></iconify-icon>
                <iconify-icon icon="mdi:test-tube" style="font-size: 3rem; color: #73A03F;"></iconify-icon>
                <iconify-icon icon="mdi:flask-outline" style="font-size: 3rem; color: #EB8225;"></iconify-icon>
                <iconify-icon icon="mdi:robot-outline" style="font-size: 3rem; color: #AB3D8B;"></iconify-icon>
                <iconify-icon icon="mdi:desktop-classic" style="font-size: 3rem; color: #0595AE;"></iconify-icon>
                <iconify-icon icon="mdi:book-open-variant" style="font-size: 3rem; color: #EB8225;"></iconify-icon>
                <iconify-icon icon="mdi:earth" style="font-size: 3rem; color: #73A03F;"></iconify-icon>
                <iconify-icon icon="mdi:atom-variant" style="font-size: 3rem; color: #AB3D8B;"></iconify-icon>
                
                <iconify-icon icon="mdi:calculator-variant" style="font-size: 3rem; color: #0595AE;"></iconify-icon>
                <iconify-icon icon="mdi:dna" style="font-size: 3rem; color: #73A03F;"></iconify-icon>
                <iconify-icon icon="mdi:beaker" style="font-size: 3rem; color: #EB8225;"></iconify-icon>
                <iconify-icon icon="mdi:chip" style="font-size: 3rem; color: #AB3D8B;"></iconify-icon>
                <iconify-icon icon="mdi:code-tags" style="font-size: 3rem; color: #0595AE;"></iconify-icon>
                <iconify-icon icon="mdi:castle" style="font-size: 3rem; color: #EB8225;"></iconify-icon>
                <iconify-icon icon="mdi:compass-outline" style="font-size: 3rem; color: #73A03F;"></iconify-icon>
                <iconify-icon icon="mdi:telescope" style="font-size: 3rem; color: #AB3D8B;"></iconify-icon>
                
                <iconify-icon icon="mdi:function-variant" style="font-size: 3rem; color: #0595AE;"></iconify-icon>
                <iconify-icon icon="mdi:leaf" style="font-size: 3rem; color: #73A03F;"></iconify-icon>
                <iconify-icon icon="mdi:molecule" style="font-size: 3rem; color: #EB8225;"></iconify-icon>
                <iconify-icon icon="mdi:cog" style="font-size: 3rem; color: #AB3D8B;"></iconify-icon>
                <iconify-icon icon="mdi:wifi" style="font-size: 3rem; color: #0595AE;"></iconify-icon>
                <iconify-icon icon="mdi:scroll-text" style="font-size: 3rem; color: #EB8225;"></iconify-icon>
                <iconify-icon icon="mdi:mountain" style="font-size: 3rem; color: #73A03F;"></iconify-icon>
                <iconify-icon icon="mdi:rocket-launch" style="font-size: 3rem; color: #AB3D8B;"></iconify-icon>
                
                <iconify-icon icon="mdi:pi" style="font-size: 3rem; color: #0595AE;"></iconify-icon>
                <iconify-icon icon="mdi:bacteria" style="font-size: 3rem; color: #73A03F;"></iconify-icon>
                <iconify-icon icon="mdi:flask-round-bottom" style="font-size: 3rem; color: #EB8225;"></iconify-icon>
                <iconify-icon icon="mdi:memory" style="font-size: 3rem; color: #AB3D8B;"></iconify-icon>
                <iconify-icon icon="mdi:cellphone" style="font-size: 3rem; color: #0595AE;"></iconify-icon>
                <iconify-icon icon="mdi:crown-outline" style="font-size: 3rem; color: #EB8225;"></iconify-icon>
                <iconify-icon icon="mdi:waves" style="font-size: 3rem; color: #73A03F;"></iconify-icon>
                <iconify-icon icon="mdi:satellite-variant" style="font-size: 3rem; color: #AB3D8B;"></iconify-icon>
                
                <iconify-icon icon="mdi:chart-line" style="font-size: 3rem; color: #0595AE;"></iconify-icon>
                <iconify-icon icon="mdi:sprout" style="font-size: 3rem; color: #73A03F;"></iconify-icon>
                <iconify-icon icon="mdi:water" style="font-size: 3rem; color: #EB8225;"></iconify-icon>
                <iconify-icon icon="mdi:robot-industrial" style="font-size: 3rem; color: #AB3D8B;"></iconify-icon>
                <iconify-icon icon="mdi:lan" style="font-size: 3rem; color: #0595AE;"></iconify-icon>
                <iconify-icon icon="mdi:pyramid" style="font-size: 3rem; color: #EB8225;"></iconify-icon>
                <iconify-icon icon="mdi:island" style="font-size: 3rem; color: #73A03F;"></iconify-icon>
                <iconify-icon icon="mdi:space-station" style="font-size: 3rem; color: #AB3D8B;"></iconify-icon>
                
                <iconify-icon icon="mdi:sigma" style="font-size: 3rem; color: #0595AE;"></iconify-icon>
                <iconify-icon icon="mdi:virus" style="font-size: 3rem; color: #73A03F;"></iconify-icon>
                <iconify-icon icon="mdi:fire" style="font-size: 3rem; color: #EB8225;"></iconify-icon>
                <iconify-icon icon="mdi:robot-happy" style="font-size: 3rem; color: #AB3D8B;"></iconify-icon>
                <iconify-icon icon="mdi:cloud-outline" style="font-size: 3rem; color: #0595AE;"></iconify-icon>
                <iconify-icon icon="mdi:sword" style="font-size: 3rem; color: #EB8225;"></iconify-icon>
                <iconify-icon icon="mdi:pine-tree" style="font-size: 3rem; color: #73A03F;"></iconify-icon>
                <iconify-icon icon="mdi:star-four-points" style="font-size: 3rem; color: #AB3D8B;"></iconify-icon>
            </div>
            
            <!-- Center Content -->
            <div class="relative z-10 text-center max-w-4xl w-full px-4">
                <!-- Logo -->
                <div class="mb-8">
                    <img src="../LogoSteamRD-Color.webp" alt="STEAM RD Logo" class="w-48 h-48 sm:w-56 sm:h-56 mx-auto mb-6" style="filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.1));">
                </div>
                
                <!-- Title -->
                <h1 class="text-6xl sm:text-7xl lg:text-8xl font-black mb-4" style="color: #AB3D8B; letter-spacing: -0.02em;">
                    TRIVIA
                </h1>
                <h2 class="text-3xl sm:text-4xl lg:text-5xl font-black mb-12" style="color: #0595AE; letter-spacing: -0.01em;">
                    STEAM RD
                </h2>
                
                <!-- Loading Bar Container -->
                <div class="max-w-md mx-auto">
                    <p class="text-lg sm:text-xl font-bold mb-4 text-steam-verde loading-text">Esperando Jugadores...</p>
                    <div class="w-full h-6 bg-gray-200 rounded-full overflow-hidden shadow-inner relative">
                        <div class="h-full bg-gradient-to-r from-steam-verde via-green-400 to-steam-verde rounded-full loading-bar"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- WAITING SCREEN -->
        <div class="screen waiting-screen flex-col items-center justify-center p-4 sm:p-6 lg:p-10 min-h-screen relative overflow-hidden bg-white" id="waitingScreen">
            <!-- Animated background removed -->
            
            <!-- Content -->
            <div class="relative z-10 w-full max-w-6xl">
                <!-- Header -->
                <div class="mb-6 sm:mb-8 lg:mb-10 text-center float-up">
                    <div class="flex justify-center mb-4 sm:mb-5">
                        <div class="inline-flex items-center gap-2 bg-white border-3 rounded-full py-3 px-6 shadow-lg" style="border-color: #0595AE;">
                            <span class="font-black text-xl sm:text-2xl text-steam-turquesa">S</span>
                            <span class="font-black text-xl sm:text-2xl text-steam-naranja">T</span>
                            <span class="font-black text-xl sm:text-2xl text-steam-verde">E</span>
                            <span class="font-black text-xl sm:text-2xl text-steam-morado">A</span>
                            <span class="font-black text-xl sm:text-2xl text-steam-turquesa">M</span>
                        </div>
                    </div>
                    <h1 class="text-4xl sm:text-5xl lg:text-7xl font-black mb-3 text-steam-morado">TRIVIA</h1>
                    <p class="text-sm sm:text-base lg:text-lg font-semibold text-steam-turquesa">Fundaci√≥n STEAM RD</p>
                </div>
                
                <!-- Status Message -->
                <div class="mb-8 sm:mb-10 text-center float-up" style="animation-delay: 0.2s;">
                    <div class="inline-flex items-center gap-3 bg-green-50 border-3 rounded-full py-4 px-8 shadow-lg" style="border-color: #73A03F;">
                        <div class="w-4 h-4 rounded-full pulse-anim bg-steam-verde"></div>
                        <h2 class="text-xl sm:text-2xl lg:text-3xl font-black text-steam-verde">Esperando Jugadores</h2>
                    </div>
                </div>
                
                <!-- Instructions -->
                <div class="text-center mb-8 sm:mb-10 float-up max-w-md mx-auto" style="animation-delay: 0.3s;">
                    <div class="bg-blue-50 rounded-2xl py-4 px-6 border-2 border-steam-turquesa">
                        <p class="text-base sm:text-lg lg:text-xl font-bold mb-2 text-steam-turquesa">üì± Escanea el c√≥digo QR</p>
                        <p class="text-sm sm:text-base text-gray-600">Usa tu tel√©fono para unirte al juego</p>
                    </div>
                </div>
                
                <!-- Players Grid -->
                <div class="flex flex-wrap gap-4 sm:gap-5 lg:gap-6 justify-center mb-8 sm:mb-10 float-up" style="animation-delay: 0.4s;" id="playersGrid">
                    <!-- Players will be added here dynamically -->
                </div>
                
                <!-- Admin Hint -->
                <div class="backdrop-blur-sm border-3 rounded-2xl py-4 px-6 text-center hidden float-up max-w-md mx-auto shadow-2xl" style="animation-delay: 0.5s; background: rgba(0, 0, 0, 0.3); border-color: #ff9900; box-shadow: 0 0 30px rgba(255, 153, 0, 0.5);" id="adminHint">
                    <div class="flex items-center justify-center gap-3">
                        <span class="text-3xl">ÔøΩ</span>
                        <p class="font-black text-base sm:text-lg" style="color: #fff; text-shadow: 0 0 10px #ff9900;">Jugador 1 es el Admin</p>
                    </div>
                </div>
                
                <!-- Education Icons Footer -->
                <div class="mt-10 sm:mt-12 flex justify-center gap-6 sm:gap-8 lg:gap-10 flex-wrap float-up" style="animation-delay: 0.6s;">
                    <iconify-icon icon="mdi:math-compass" class="text-3xl sm:text-4xl lg:text-5xl" style="color: #0595AE;"></iconify-icon>
                    <iconify-icon icon="mdi:microscope" class="text-3xl sm:text-4xl lg:text-5xl" style="color: #73A03F;"></iconify-icon>
                    <iconify-icon icon="mdi:flask" class="text-3xl sm:text-4xl lg:text-5xl" style="color: #EB8225;"></iconify-icon>
                    <iconify-icon icon="mdi:robot" class="text-3xl sm:text-4xl lg:text-5xl" style="color: #AB3D8B;"></iconify-icon>
                    <iconify-icon icon="mdi:laptop" class="text-3xl sm:text-4xl lg:text-5xl" style="color: #0595AE;"></iconify-icon>
                    <iconify-icon icon="mdi:book-open-page-variant" class="text-3xl sm:text-4xl lg:text-5xl" style="color: #EB8225;"></iconify-icon>
                    <iconify-icon icon="mdi:map" class="text-3xl sm:text-4xl lg:text-5xl" style="color: #73A03F;"></iconify-icon>
                </div>
            </div>
        </div>

        <!-- CATEGORY SCREEN -->
        <div class="screen flex-col p-4 sm:p-6 lg:p-8 h-screen overflow-hidden relative bg-white" id="categoryScreen">
            <!-- Animated Background Particles (soft colored blobs) -->
            <div class="bg-particles" id="bgParticles"></div>
            
            <!-- Content Container -->
            <div class="relative z-10 flex flex-col h-full">
                <!-- Header -->
                <div class="text-center mb-4 sm:mb-6 power-up">
                    <!-- Level indicator dots above title -->
                    <div class="flex justify-center gap-2 mb-3">
                        <div class="w-3 h-3 rounded-full animate-pulse bg-steam-naranja"></div>
                        <div class="w-3 h-3 rounded-full animate-pulse bg-steam-verde" style="animation-delay: 0.2s;"></div>
                        <div class="w-3 h-3 rounded-full animate-pulse bg-steam-morado" style="animation-delay: 0.4s;"></div>
                    </div>
                    
                    <!-- Title with crown -->
                    <div class="inline-flex items-center gap-3 bg-white border-3 border-steam-turquesa rounded-full py-3 px-6 shadow-lg">
                        <iconify-icon icon="mdi:crown" style="font-size: clamp(1.5rem, 4vw, 2rem); color: #EB8225;"></iconify-icon>
                        <span class="font-black text-base sm:text-lg text-steam-turquesa">JUGADOR 1: ELIGE TU DESAF√çO</span>
                        <iconify-icon icon="mdi:gamepad-variant" style="font-size: clamp(1.5rem, 4vw, 2rem); color: #AB3D8B;"></iconify-icon>
                    </div>
                </div>
                
                <!-- Categories Grid with Game Cards -->
                <div class="flex-1 flex items-center justify-center px-2">
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-5 lg:gap-6 max-w-6xl w-full" id="categoryGrid"></div>
                </div>
                
                <!-- Footer Message -->
                <div class="text-center mt-4 sm:mt-6 power-up" style="animation-delay: 0.3s;">
                    <div class="inline-flex items-center gap-3 py-2 px-4">
                        <iconify-icon icon="mdi:clock-outline" style="font-size: 1.5rem; color: #EB8225;"></iconify-icon>
                        <p class="font-bold text-sm sm:text-base text-steam-naranja">
                            Esperando selecci√≥n...
                        </p>
                        <iconify-icon icon="mdi:clock-outline" style="font-size: 1.5rem; color: #EB8225;"></iconify-icon>
                    </div>
                </div>
            </div>
        </div>

        <!-- PLAYING SCREEN -->
        <div class="screen flex-col h-full" id="playingScreen" style="background: linear-gradient(135deg, #1a2e1a 0%, #0d1f0d 100%);">
            <!-- Players Header Bar with Timer -->
            <div class="flex items-center justify-between p-2 sm:p-3 lg:p-4 gap-2 sm:gap-3 relative z-10" style="background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(10px);">
                <!-- Progress Bar -->
                <div class="absolute top-0 left-0 right-0 h-1 bg-gray-800">
                    <div class="h-full bg-gradient-to-r from-green-400 to-blue-500 transition-all duration-1000" id="progressBar" style="width: 100%;"></div>
                </div>
                
                <div class="flex gap-2 sm:gap-3 flex-1 justify-center flex-wrap" id="playersHeaderBar">
                    <!-- Players will be added here dynamically -->
                </div>
                
                <!-- Timer Circle -->
                <div class="w-12 sm:w-16 lg:w-20 h-12 sm:h-16 lg:h-20 rounded-full flex items-center justify-center text-xl sm:text-3xl lg:text-4xl font-bold text-white shadow-lg border-3 transition-all flex-shrink-0" id="timerCircle" style="background: #0595AE; border-color: #fff; box-shadow: 0 0 20px rgba(5, 149, 174, 0.6);">20</div>
            </div>

            <!-- Content -->
            <div class="flex-1 flex flex-col px-3 sm:px-6 lg:px-10 pb-2 sm:pb-4 lg:pb-8 relative">
                <!-- Background particles for playing screen -->
                <div class="bg-particles" id="playingBgParticles"></div>
                
                <div class="flex-1 flex flex-col items-center justify-center relative z-10">
                    <div class="text-sm sm:text-base lg:text-lg mb-2 sm:mb-3 lg:mb-4 font-bold text-green-400" id="questionNumber" style="text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);">Pregunta 1 de 5</div>
                    <h2 class="responsive-question text-center max-w-xs sm:max-w-2xl lg:max-w-4xl leading-tight mb-4 sm:mb-6 lg:mb-10 text-white" id="questionText" style="text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);">Cual es la capital de Francia?</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 lg:gap-4 max-w-xs sm:max-w-2xl lg:max-w-4xl w-full" id="optionsGrid"></div>
                </div>
            </div>
            
            <!-- Footer with Players -->
            <div class="p-3 sm:p-4 lg:p-6 relative z-10" style="background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(10px);">
                <div class="flex gap-3 sm:gap-4 justify-center flex-wrap" id="playersFooter">
                    <!-- Players will be added here dynamically -->
                </div>
            </div>
        </div>

        <!-- END SCREEN -->
        <div class="screen flex-col items-center justify-center p-4 sm:p-6 lg:p-10 overflow-y-auto" id="endScreen">
            <h2 class="text-xl sm:text-2xl lg:text-3xl text-steam-turquesa mb-4 sm:mb-6 lg:mb-8 font-bold">Juego Terminado!</h2>
            <div class="winner-bounce text-center mb-4 sm:mb-6 lg:mb-8" id="winnerSection"></div>
            <div class="flex flex-col gap-2 sm:gap-3 max-w-xs sm:max-w-md lg:max-w-lg w-full mb-4 sm:mb-6 lg:mb-8" id="podium"></div>
            <div class="bg-orange-50 border-2 border-steam-naranja rounded-xl sm:rounded-2xl py-3 sm:py-4 lg:py-5 px-4 sm:px-6 lg:px-8 text-center animate-pulse">
                <p class="text-steam-naranja text-sm sm:text-base lg:text-lg font-bold">Esperando que el Jugador 1 decida...</p>
            </div>
        </div>

        <!-- Sound toggle -->
        <div class="absolute bottom-3 sm:bottom-5 right-3 sm:right-5 text-2xl sm:text-3xl cursor-pointer opacity-70 hover:opacity-100 transition-opacity z-50" id="soundToggle">üîä</div>
        
        <!-- Confetti container -->
        <div class="fixed top-0 left-0 w-full h-full pointer-events-none z-[1000] overflow-hidden" id="confettiContainer"></div>
    </div>

    <script>
        const categories = {
            general: { name: "General", icon: "mdi:earth", color: "general" },
            science: { name: "Ciencia", icon: "mdi:microscope", color: "science" },
            mathematics: { name: "Matematicas", icon: "mdi:math-compass", color: "mathematics" },
            robotics: { name: "Robotica", icon: "mdi:robot", color: "robotics" },
            chemistry: { name: "Quimica", icon: "mdi:flask", color: "chemistry" },
            technology: { name: "Tecnologia", icon: "mdi:laptop", color: "technology" },
            history: { name: "Historia", icon: "mdi:book-open-page-variant", color: "history" },
            geography: { name: "Geografia", icon: "mdi:map", color: "geography" }
        };

        const questions = {
            general: [
                { question: "Cual es la capital de Francia?", options: ["Londres", "Paris", "Berlin", "Madrid"], correct: 1 },
                { question: "En que a√±o llego el hombre a la Luna?", options: ["1965", "1969", "1972", "1975"], correct: 1 },
                { question: "Quien pinto la Mona Lisa?", options: ["Picasso", "Van Gogh", "Leonardo da Vinci", "Miguel Angel"], correct: 2 },
                { question: "Cual es el oceano mas grande del mundo?", options: ["Atlantico", "Indico", "Artico", "Pacifico"], correct: 3 },
                { question: "Cuantos continentes hay en la Tierra?", options: ["5", "6", "7", "8"], correct: 2 }
            ],
            science: [
                { question: "Cual es el elemento quimico del oro?", options: ["Go", "Gd", "Au", "Ag"], correct: 2 },
                { question: "Que planeta es el mas cercano al Sol?", options: ["Venus", "Mercurio", "Marte", "Tierra"], correct: 1 },
                { question: "Cuantos huesos tiene el cuerpo humano adulto?", options: ["196", "206", "216", "226"], correct: 1 },
                { question: "Cual es el animal mas grande del mundo?", options: ["Elefante", "Tiburon blanco", "Ballena azul", "Jirafa"], correct: 2 },
                { question: "Cual es la galaxia en la que vivimos?", options: ["Andromeda", "Via Lactea", "Sombrero", "Triangulo"], correct: 1 }
            ],
            mathematics: [
                { question: "Cuanto es 2 + 2 √ó 3?", options: ["12", "8", "10", "6"], correct: 1 },
                { question: "Cual es la raiz cuadrada de 144?", options: ["10", "11", "12", "13"], correct: 2 },
                { question: "Cuantos grados tiene un triangulo?", options: ["180", "360", "90", "270"], correct: 0 },
                { question: "Cual es el numero pi aproximadamente?", options: ["2.14", "3.14", "4.14", "5.14"], correct: 1 },
                { question: "Cuantos lados tiene un hexagono?", options: ["4", "5", "6", "7"], correct: 2 }
            ],
            robotics: [
                { question: "Que significa AI en robotica?", options: ["Automated Intelligence", "Artificial Intelligence", "Advanced Integration", "Automatic Interface"], correct: 1 },
                { question: "Que sensor se usa para detectar obstaculos?", options: ["GPS", "Ultrasonido", "Bluetooth", "WiFi"], correct: 1 },
                { question: "Que lenguaje se usa comunmente en Arduino?", options: ["Python", "Java", "C/C++", "JavaScript"], correct: 2 },
                { question: "Que es un actuador en robotica?", options: ["Sensor", "Motor", "Bateria", "Procesador"], correct: 1 },
                { question: "Que es ROS en robotica?", options: ["Robot Operating System", "Robotic Output System", "Remote Operation Software", "Robot Optimization Suite"], correct: 0 }
            ],
            chemistry: [
                { question: "Cual es el simbolo del elemento oxigeno?", options: ["Ox", "O2", "O", "Ox2"], correct: 2 },
                { question: "Cuantos elementos hay en la tabla periodica?", options: ["108", "118", "128", "138"], correct: 1 },
                { question: "Cual es la formula del dioxido de carbono?", options: ["CO", "CO2", "C2O", "C2O2"], correct: 1 },
                { question: "Que pH tiene una sustancia neutra?", options: ["0", "7", "14", "10"], correct: 1 },
                { question: "Cual es la formula quimica del agua?", options: ["H2", "O2", "H2O", "HO"], correct: 2 }
            ],
            technology: [
                { question: "Que significa www en una direccion web?", options: ["World Wide Web", "World Web Way", "Wide World Web", "Web World Wide"], correct: 0 },
                { question: "Que compa√±ia creo Android?", options: ["Apple", "Microsoft", "Google", "Samsung"], correct: 2 },
                { question: "Que significa CPU?", options: ["Central Processing Unit", "Computer Power Unit", "Control Processing Unit", "Central Power Unit"], correct: 0 },
                { question: "Que significa HTML?", options: ["HyperText Markup Language", "High Tech Machine Learning", "Home Tool Management List", "Hyper Transfer Media Link"], correct: 0 },
                { question: "Que compa√±ia creo Windows?", options: ["Apple", "Google", "Microsoft", "IBM"], correct: 2 }
            ],
            history: [
                { question: "En que a√±o cayo el Imperio Romano de Occidente?", options: ["410", "476", "500", "600"], correct: 1 },
                { question: "Quien fue el primer presidente de EEUU?", options: ["Jefferson", "Lincoln", "Washington", "Adams"], correct: 2 },
                { question: "Que civilizacion construyo las piramides de Giza?", options: ["Griega", "Egipcia", "Romana", "Maya"], correct: 1 },
                { question: "En que a√±o termino la Segunda Guerra Mundial?", options: ["1943", "1944", "1945", "1946"], correct: 2 },
                { question: "En que a√±o llego Colon a America?", options: ["1492", "1500", "1510", "1520"], correct: 0 }
            ],
            geography: [
                { question: "Cual es el rio mas largo del mundo?", options: ["Amazonas", "Nilo", "Yangtse", "Misisipi"], correct: 1 },
                { question: "Cual es la monta√±a mas alta del mundo?", options: ["K2", "Kangchenjunga", "Everest", "Makalu"], correct: 2 },
                { question: "Cual es la capital de Australia?", options: ["Sidney", "Melbourne", "Canberra", "Brisbane"], correct: 2 },
                { question: "Cual es el desierto mas grande del mundo?", options: ["Sahara", "Gobi", "Antartico", "Arabia"], correct: 0 },
                { question: "Cual es la capital de Canada?", options: ["Toronto", "Vancouver", "Montreal", "Ottawa"], correct: 3 }
            ]
        };

        const playerColors = ['#0595AE', '#73A03F', '#EB8225', '#AB3D8B'];
        
        let airconsole;
        let players = {};
        let gameState = 'waiting';
        let currentQuestion = 0;
        let gameQuestions = [];
        let questionStartTime = 0;
        let answers = {};
        let selectedCategory = 'general';
        let timer = null;
        let timeLeft = 20;
        let soundEnabled = true;
        let adminDeviceId = null;

        const domCache = {};

        function cacheDomElements() {
            domCache.timerCircle = document.getElementById('timerCircle');
            domCache.questionNumber = document.getElementById('questionNumber');
            domCache.questionText = document.getElementById('questionText');
            domCache.optionsGrid = document.getElementById('optionsGrid');
            domCache.playersGrid = document.getElementById('playersGrid');
            domCache.adminHint = document.getElementById('adminHint');
        }

        let audioContext;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playSound(type) {
            if (!soundEnabled) return;
            initAudio();
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'join':
                    oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(784, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;
                case 'correct':
                    [523, 659, 784].forEach((freq, i) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0.15, audioContext.currentTime + i * 0.08);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.08 + 0.15);
                        osc.start(audioContext.currentTime + i * 0.08);
                        osc.stop(audioContext.currentTime + i * 0.08 + 0.15);
                    });
                    break;
                case 'wrong':
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.3);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
                case 'tick':
                    oscillator.frequency.value = 800;
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.05);
                    break;
                case 'victory':
                    [523, 659, 784, 1047].forEach((freq, i) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.15);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.15 + 0.3);
                        osc.start(audioContext.currentTime + i * 0.15);
                        osc.stop(audioContext.currentTime + i * 0.15 + 0.3);
                    });
                    break;
            }
        }

        function createConfetti() {
            const container = document.getElementById('confettiContainer');
            container.innerHTML = '';
            const colors = ['#0595AE', '#AB3D8B', '#EB8225', '#73A03F'];
            
            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = (2 + Math.random() * 2) + 's';
                container.appendChild(confetti);
            }
            
            setTimeout(() => container.innerHTML = '', 5000);
        }

        function setCategoryBackground(category) {
            document.body.className = 'cat-' + (categories[category]?.color || 'default') + ' font-sans text-steam-negro overflow-hidden';
        }

        function init() {
            airconsole = new AirConsole();
            cacheDomElements();
            
            // Initialize particle network background
            initParticleNetwork();
            
            function animateIntroScreen() {
                console.log('Starting intro animations...');
                
                // Simple fade in for intro screen
                const introScreen = document.getElementById('introScreen');
                if (introScreen) {
                    introScreen.style.opacity = '1';
                }
                
                console.log('Intro animation complete!');
            }

            airconsole.onReady = function() {
                console.log('Screen ready');
                setupCategories();
                
                // Start on intro screen, stay there until players join
                showScreen('intro');
            };

            airconsole.onConnect = function(deviceId) {
                console.log("üîå Device connected:", deviceId);
                // Don't auto-join, wait for explicit join message
            };

            airconsole.onDisconnect = function(deviceId) {
                console.log("üîå Device disconnected:", deviceId);
                
                if (players[deviceId]) {
                    const player = players[deviceId];
                    console.log(`‚ö†Ô∏è Player ${player.name} disconnected - marking as disconnected`);
                    
                    player.disconnected = true;
                    updatePlayersDisplay();
                    
                    airconsole.broadcast({
                        action: 'playerDisconnected',
                        playerId: deviceId,
                        playerName: player.name
                    });
                    
                    console.log(`üìä Active players: ${Object.values(players).filter(p => !p.disconnected).length}/${Object.keys(players).length}`);
                } else {
                    console.log(`‚ÑπÔ∏è Disconnected device ${deviceId} was not in active players`);
                }
            };

            airconsole.onMessage = function(deviceId, data) {
                console.log("Received:", data.action, "from", deviceId);
                
                if (data.action === 'join') {
                    // Check if player already exists
                    if (players[deviceId]) {
                        if (players[deviceId].disconnected) {
                            // Reconnecting player
                            const existingPlayer = players[deviceId];
                            existingPlayer.disconnected = false;
                            
                            airconsole.message(deviceId, {
                                action: 'reconnected',
                                color: existingPlayer.color,
                                isAdmin: existingPlayer.isAdmin,
                                gameState: gameState,
                                selectedCategory: selectedCategory,
                                score: existingPlayer.score
                            });
                            
                            console.log(`‚ú® Player ${existingPlayer.name} reconnected`);
                            updatePlayersDisplay();
                            broadcastGameState();
                        } else {
                            // Already joined, just confirm
                            const p = players[deviceId];
                            airconsole.message(deviceId, {
                                action: 'joined',
                                color: p.color,
                                isAdmin: p.isAdmin,
                                gameState: gameState,
                                selectedCategory: selectedCategory
                            });
                        }
                    } else {
                        // New player joining
                        const connectedPlayersCount = Object.keys(players).filter(
                            id => !players[id].disconnected
                        ).length;
                        
                        if (connectedPlayersCount < 4) {
                            const isAdmin = adminDeviceId === null;
                            if (isAdmin) {
                                adminDeviceId = deviceId;
                                console.log(`üëë Device ${deviceId} assigned as admin`);
                            }
                            
                            const playerColor = playerColors[Object.keys(players).length % playerColors.length];
                            const playerName = airconsole.getNickname(deviceId) || `Jugador ${Object.keys(players).length + 1}`;
                            
                            players[deviceId] = {
                                id: deviceId,
                                name: playerName,
                                score: 0,
                                color: playerColor,
                                isAdmin: isAdmin,
                                disconnected: false
                            };
                            
                            playSound('join');
                            
                            airconsole.message(deviceId, {
                                action: 'joined',
                                color: playerColor,
                                isAdmin: isAdmin,
                                gameState: gameState,
                                selectedCategory: selectedCategory
                            });
                            
                            console.log(`‚úÖ Player ${playerName} joined successfully!`);
                            updatePlayersDisplay();
                            
                            // First player joins - transition from intro to category selection
                            if (isAdmin && (gameState === 'waiting' || gameState === 'intro')) {
                                showScreen('category');
                                gameState = 'categorySelect';
                            }
                            
                            broadcastGameState();
                        } else {
                            console.log(`‚ö†Ô∏è Cannot join: Game is full (4/4 players)`);
                            airconsole.message(deviceId, {
                                action: 'gameFull'
                            });
                        }
                    }
                    
                } else if (data.action === 'selectCategory' && deviceId === adminDeviceId) {
                    selectedCategory = data.category;
                    setCategoryBackground(selectedCategory);
                    
                    document.querySelectorAll('.category-card').forEach(card => {
                        card.classList.remove('border-steam-verde', 'bg-green-50');
                        card.classList.add('border-gray-200');
                    });
                    const selected = document.querySelector(`[data-category="${data.category}"]`);
                    if (selected) {
                        selected.classList.remove('border-gray-200');
                        selected.classList.add('border-steam-verde', 'bg-green-50');
                    }
                    
                    airconsole.broadcast({ action: 'categorySelected', category: data.category });
                    
                } else if (data.action === 'startGame' && deviceId === adminDeviceId) {
                    startGame();
                    
                } else if (data.action === 'answer' && gameState === 'playing') {
                    handleAnswer(deviceId, data.option, data.timestamp);
                    
                } else if (data.action === 'playAgain' && deviceId === adminDeviceId) {
                    resetGame();
                }
            };

            document.getElementById('soundToggle').addEventListener('click', toggleSound);
        }

        function broadcastGameState() {
            airconsole.broadcast({
                action: 'gameStateUpdate',
                gameState: gameState,
                selectedCategory: selectedCategory,
                players: players,
                adminId: adminDeviceId
            });
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').textContent = soundEnabled ? 'üîä' : 'üîá';
        }
        
        // Particle Network Animation - Disabled for clean background
        function initParticleNetwork() {
            // Clean white background - no particles
        }

        function setupCategories() {
            const grid = document.getElementById('categoryGrid');
            grid.innerHTML = '';
            
            const categoryColors = {
                general: { primary: '#0595AE', bg: '#E8F4F8' },
                science: { primary: '#73A03F', bg: '#E8F5E9' },
                mathematics: { primary: '#0595AE', bg: '#E3F2FD' },
                robotics: { primary: '#AB3D8B', bg: '#F3E5F5' },
                chemistry: { primary: '#73A03F', bg: '#E0F2F1' },
                technology: { primary: '#AB3D8B', bg: '#FCE4EC' },
                history: { primary: '#EB8225', bg: '#FFF3E0' },
                geography: { primary: '#0595AE', bg: '#E0F7FA' }
            };
            
            Object.entries(categories).forEach(([key, category], index) => {
                const card = document.createElement('div');
                const colors = categoryColors[key] || categoryColors.general;
                
                card.className = 'category-card bg-white rounded-3xl p-4 sm:p-5 lg:p-6 text-center cursor-pointer transition-all shadow-lg hover:shadow-xl relative overflow-hidden power-up';
                card.style.animationDelay = `${index * 0.1}s`;
                card.style.border = `3px solid ${colors.primary}`;
                card.dataset.category = key;
                
                card.innerHTML = `
                    <!-- Icon container -->
                    <div class="relative mb-3 sm:mb-4">
                        <iconify-icon icon="${category.icon}" class="category-icon relative z-10" style="color: ${colors.primary};"></iconify-icon>
                    </div>
                    
                    <!-- Category name -->
                    <div class="relative text-base sm:text-lg lg:text-xl font-black uppercase tracking-wide mb-2" style="color: ${colors.primary};">
                        ${category.name}
                    </div>
                    
                    <!-- Underline -->
                    <div class="flex gap-1 justify-center mt-2">
                        <div class="w-8 h-1 rounded-full" style="background: ${colors.primary};"></div>
                        <div class="w-8 h-1 rounded-full opacity-70" style="background: ${colors.primary};"></div>
                        <div class="w-8 h-1 rounded-full opacity-40" style="background: ${colors.primary};"></div>
                    </div>
                    
                    <!-- Selection indicator -->
                    <div class="absolute top-2 right-2 w-6 h-6 rounded-full items-center justify-center text-xs font-bold hidden selection-check bg-steam-verde text-white shadow-md">
                        ‚úì
                    </div>
                `;
                
                // Add click handler with animation
                card.addEventListener('click', () => {
                    // Remove selection from all cards
                    document.querySelectorAll('.category-card').forEach(c => {
                        c.classList.remove('selected', 'scale-105');
                        c.querySelector('.selection-check')?.classList.add('hidden');
                        c.querySelector('.selection-check')?.classList.remove('flex');
                    });
                    
                    // Add selection to clicked card
                    card.classList.add('selected', 'scale-105');
                    card.querySelector('.selection-check')?.classList.remove('hidden');
                    card.querySelector('.selection-check')?.classList.add('flex');
                    
                    // Change background with animation
                    setCategoryBackground(key);
                    createBackgroundParticles(key);
                    
                    // Animate icon with anime.js
                    if (anime && anime.animate) {
                        anime.animate(card.querySelector('.category-icon'), {
                            scale: [1, 1.3, 1],
                            rotate: ['0deg', '360deg'],
                            duration: 800,
                            ease: 'inOutElastic(1, .6)'
                        });
                    }
                    
                    // Animate card
                    if (anime && anime.animate) {
                        anime.animate(card, {
                            scale: [1, 1.05, 1.02],
                            duration: 400,
                            ease: 'outElastic(1, .8)'
                        });
                    }
                    
                    // Play selection sound
                    playSound('join');
                    
                    // Send message to controllers
                    if (airconsole) {
                        airconsole.broadcast({ action: 'categorySelected', category: key });
                    }
                });
                
                grid.appendChild(card);
            });
            
            // Select first category by default with animation
            setTimeout(() => {
                const firstCard = document.querySelector('.category-card');
                if (firstCard) {
                    firstCard.click();
                }
            }, 500);
        }

        function createStarBurst(element) {
            // Simplified - no star burst for child-friendly design
        }

        function createBackgroundParticles(category) {
            const container = document.getElementById('bgParticles');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Soft pastel colors for background blobs
            const colorMap = {
                general: ['rgba(5, 149, 174, 0.15)', 'rgba(115, 160, 63, 0.15)', 'rgba(235, 130, 37, 0.15)'],
                science: ['rgba(115, 160, 63, 0.15)', 'rgba(5, 149, 174, 0.12)', 'rgba(171, 61, 139, 0.12)'],
                mathematics: ['rgba(5, 149, 174, 0.15)', 'rgba(171, 61, 139, 0.12)', 'rgba(115, 160, 63, 0.12)'],
                robotics: ['rgba(171, 61, 139, 0.15)', 'rgba(235, 130, 37, 0.12)', 'rgba(5, 149, 174, 0.12)'],
                chemistry: ['rgba(115, 160, 63, 0.15)', 'rgba(235, 130, 37, 0.12)', 'rgba(5, 149, 174, 0.12)'],
                technology: ['rgba(171, 61, 139, 0.15)', 'rgba(5, 149, 174, 0.12)', 'rgba(235, 130, 37, 0.12)'],
                history: ['rgba(235, 130, 37, 0.15)', 'rgba(171, 61, 139, 0.12)', 'rgba(115, 160, 63, 0.12)'],
                geography: ['rgba(5, 149, 174, 0.15)', 'rgba(115, 160, 63, 0.12)', 'rgba(235, 130, 37, 0.12)']
            };
            
            const colors = colorMap[category] || colorMap.general;
            
            // Create soft colored blob particles
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                const size = Math.random() * 200 + 100;
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                particle.className = 'particle';
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.borderRadius = '50%';
                particle.style.background = color;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 5 + 's';
                particle.style.animationDuration = (Math.random() * 20 + 20) + 's';
                particle.style.filter = 'blur(40px)';
                particle.style.opacity = '0.15';
                
                container.appendChild(particle);
            }
            
            // Animate particles entrance with anime.js
            if (anime && anime.animate && anime.stagger) {
                anime.animate('.particle', {
                    opacity: [0, 0.15],
                    scale: [0, 1],
                    duration: 1000,
                    delay: anime.stagger(50),
                    ease: 'outElastic(1, .8)'
                });
            }
        }

        function updatePlayersDisplay() {
            const grid = domCache.playersGrid || document.getElementById('playersGrid');
            const fragment = document.createDocumentFragment();
            
            const playerColors = ['#0595AE', '#73A03F', '#EB8225', '#AB3D8B'];
            
            Object.values(players).forEach((player, index) => {
                const card = document.createElement('div');
                const cardColor = playerColors[index % playerColors.length];
                
                card.className = 'bg-white rounded-2xl py-4 px-5 flex items-center gap-3 shadow-lg transition-all hover:scale-105 relative overflow-hidden';
                
                if (player.disconnected) {
                    card.style.background = '#f3f4f6';
                    card.style.border = '2px solid #d1d5db';
                    card.style.opacity = '0.6';
                } else {
                    card.style.border = `3px solid ${cardColor}`;
                }
                
                // Avatar
                const avatar = document.createElement('div');
                avatar.className = 'w-14 h-14 sm:w-16 sm:h-16 rounded-full flex items-center justify-center relative flex-shrink-0 shadow-md';
                avatar.style.background = player.disconnected ? '#9ca3af' : player.color;
                avatar.style.border = `3px solid ${player.disconnected ? '#6b7280' : '#fff'}`;
                
                if (player.isAdmin && !player.disconnected) {
                    avatar.innerHTML = '<iconify-icon icon="mdi:crown" style="font-size: 1.5rem; color: white;"></iconify-icon>';
                } else if (player.disconnected) {
                    avatar.innerHTML = '<iconify-icon icon="mdi:close-circle" style="font-size: 1.5rem; color: white;"></iconify-icon>';
                } else {
                    avatar.innerHTML = '<iconify-icon icon="mdi:gamepad-variant" style="font-size: 1.5rem; color: white;"></iconify-icon>';
                }
                card.appendChild(avatar);
                
                // Info
                const info = document.createElement('div');
                info.className = 'flex-1 min-w-0';
                info.innerHTML = `
                    <div class="text-base sm:text-lg font-black truncate" style="color: ${player.disconnected ? '#6b7280' : '#010101'};">${player.name}</div>
                    <div class="text-xs sm:text-sm font-bold" style="color: ${player.disconnected ? '#9ca3af' : cardColor};">
                        ${player.disconnected ? 'Desconectado' : (player.isAdmin ? 'üëë Admin' : '‚úì Conectado')}
                    </div>
                `;
                card.appendChild(info);
                
                fragment.appendChild(card);
            });
            
            grid.innerHTML = '';
            grid.appendChild(fragment);

            // Create waiting particles
            createWaitingParticles();

            const adminHint = domCache.adminHint || document.getElementById('adminHint');
            if (adminHint && Object.keys(players).length >= 1) {
                adminHint.classList.remove('hidden');
            }

            updatePlayersStatus();
        }

        function createWaitingParticles() {
            // Particles disabled - clean white background
        }

        function updatePlayersStatus() {
            const headerContainer = document.getElementById('playersHeaderBar');
            const footerContainer = document.getElementById('playersFooter');
            if (!headerContainer || !footerContainer) return;
            
            const headerFragment = document.createDocumentFragment();
            const footerFragment = document.createDocumentFragment();
            
            Object.values(players).forEach((player, index) => {
                const hasAnswered = answers[player.id] !== undefined;
                
                // Player colors for the card
                const cardColors = ['#00ff88', '#00d9ff', '#ff00ff', '#ff9900'];
                const cardColor = cardColors[index % cardColors.length];
                
                // Header card (compact)
                const headerCard = document.createElement('div');
                headerCard.className = 'flex items-center gap-2 backdrop-blur-sm rounded-xl py-2 px-3 transition-all relative overflow-hidden';
                headerCard.style.background = player.disconnected ? 'rgba(100, 100, 100, 0.3)' : `rgba(0, 0, 0, 0.4)`;
                headerCard.style.border = `2px solid ${player.disconnected ? '#666' : cardColor}`;
                headerCard.style.boxShadow = player.disconnected ? 'none' : `0 0 15px ${cardColor}44`;
                headerCard.style.minWidth = 'clamp(100px, 15vw, 140px)';
                
                // Avatar
                const avatar = document.createElement('div');
                avatar.className = 'w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center';
                avatar.style.background = player.disconnected ? '#666' : player.color;
                avatar.style.border = `2px solid ${player.disconnected ? '#444' : '#fff'}`;
                avatar.style.boxShadow = player.disconnected ? 'none' : `0 0 10px ${cardColor}`;
                avatar.innerHTML = `<span class="text-sm sm:text-base">${player.disconnected ? '‚ùå' : (hasAnswered ? '‚úì' : 'üéÆ')}</span>`;
                headerCard.appendChild(avatar);
                
                // Name
                const name = document.createElement('div');
                name.className = 'font-bold text-xs sm:text-sm truncate flex-1';
                name.style.color = player.disconnected ? '#999' : '#fff';
                name.style.textShadow = '0 1px 3px rgba(0,0,0,0.5)';
                name.textContent = player.name;
                headerCard.appendChild(name);
                
                headerFragment.appendChild(headerCard);
                
                // Footer card (with score)
                const footerCard = document.createElement('div');
                footerCard.className = 'flex flex-col items-center gap-2 backdrop-blur-sm rounded-xl py-3 px-4 transition-all';
                footerCard.style.background = player.disconnected ? 'rgba(100, 100, 100, 0.3)' : `rgba(0, 0, 0, 0.4)`;
                footerCard.style.border = `2px solid ${player.disconnected ? '#666' : cardColor}`;
                footerCard.style.boxShadow = player.disconnected ? 'none' : `0 0 15px ${cardColor}44`;
                footerCard.style.minWidth = 'clamp(80px, 12vw, 120px)';
                
                // Avatar
                const footerAvatar = document.createElement('div');
                footerAvatar.className = 'w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center';
                footerAvatar.style.background = player.disconnected ? '#666' : player.color;
                footerAvatar.style.border = `3px solid ${player.disconnected ? '#444' : '#fff'}`;
                footerAvatar.style.boxShadow = player.disconnected ? 'none' : `0 0 10px ${cardColor}`;
                footerAvatar.innerHTML = `<span class="text-base sm:text-lg">${player.disconnected ? '‚ùå' : 'üéÆ'}</span>`;
                footerCard.appendChild(footerAvatar);
                
                // Name
                const footerName = document.createElement('div');
                footerName.className = 'font-bold text-xs sm:text-sm truncate text-center';
                footerName.style.color = player.disconnected ? '#999' : '#fff';
                footerName.style.textShadow = '0 1px 3px rgba(0,0,0,0.5)';
                footerName.textContent = player.name;
                footerCard.appendChild(footerName);
                
                // Score
                const score = document.createElement('div');
                score.className = 'text-sm sm:text-base font-bold px-2 py-1 rounded-lg';
                score.style.background = player.disconnected ? '#444' : cardColor;
                score.style.color = '#fff';
                score.style.textShadow = '0 1px 2px rgba(0,0,0,0.5)';
                score.textContent = `${player.score} pts`;
                footerCard.appendChild(score);
                
                footerFragment.appendChild(footerCard);
            });
            
            headerContainer.innerHTML = '';
            headerContainer.appendChild(headerFragment);
            
            footerContainer.innerHTML = '';
            footerContainer.appendChild(footerFragment);
        }

        function startGame() {
            gameState = 'playing';
            currentQuestion = 0;
            
            const categoryQuestions = questions[selectedCategory] || questions.general;
            gameQuestions = [...categoryQuestions].sort(() => Math.random() - 0.5).slice(0, 5);
            
            Object.keys(players).forEach(id => {
                players[id].score = 0;
            });

            setCategoryBackground(selectedCategory);
            showScreen('playing');
            
            airconsole.broadcast({ 
                action: 'gameStart',
                category: selectedCategory,
                question: { index: currentQuestion, total: gameQuestions.length }
            });
            
            setTimeout(() => showQuestion(), 300);
        }

        function showQuestion() {
            answers = {};
            questionStartTime = Date.now();
            timeLeft = 20;
            
            const question = gameQuestions[currentQuestion];
            if (domCache.questionNumber) domCache.questionNumber.textContent = `Pregunta ${currentQuestion + 1} de ${gameQuestions.length}`;
            if (domCache.questionText) domCache.questionText.textContent = question.question;
            
            displayOptions(question);
            updatePlayersStatus();
            updateScoreboard();
            startTimer();
            createPlayingParticles();
            
            airconsole.broadcast({
                action: 'showQuestion',
                questionIndex: currentQuestion,
                totalQuestions: gameQuestions.length
            });
        }

        function createPlayingParticles() {
            const container = document.getElementById('playingBgParticles');
            if (!container) return;
            
            container.innerHTML = '';
            
            const colors = ['rgba(0, 255, 136, 0.1)', 'rgba(0, 217, 255, 0.1)', 'rgba(255, 153, 0, 0.1)'];
            
            // Create subtle floating particles
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                const size = Math.random() * 40 + 20;
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                particle.className = 'particle';
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.borderRadius = '50%';
                particle.style.background = `radial-gradient(circle, ${color}, transparent)`;
                particle.style.boxShadow = `0 0 ${size}px ${color}`;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 5 + 's';
                particle.style.animationDuration = (Math.random() * 15 + 15) + 's';
                particle.style.opacity = '0.3';
                
                container.appendChild(particle);
            }
        }

        function displayOptions(question) {
            const container = domCache.optionsGrid || document.getElementById('optionsGrid');
            container.innerHTML = '';
            
            const letters = ['A', 'B', 'C', 'D'];
            const optionColors = [
                { bg: '#d4a574', border: '#b8894f', shadow: 'rgba(212, 165, 116, 0.5)' },
                { bg: '#4db8e8', border: '#3a9bc7', shadow: 'rgba(77, 184, 232, 0.5)' },
                { bg: '#e85d8a', border: '#c74a72', shadow: 'rgba(232, 93, 138, 0.5)' },
                { bg: '#9b6fd8', border: '#7d59b3', shadow: 'rgba(155, 111, 216, 0.5)' }
            ];
            
            const fragment = document.createDocumentFragment();
            question.options.forEach((option, index) => {
                const card = document.createElement('div');
                const colors = optionColors[index];
                
                card.className = 'option-card flex items-center rounded-xl sm:rounded-2xl overflow-hidden border-3 shadow-lg transition-all cursor-pointer hover:scale-105 relative';
                card.style.background = `linear-gradient(135deg, ${colors.bg}, ${colors.border})`;
                card.style.borderColor = colors.border;
                card.style.boxShadow = `0 4px 15px ${colors.shadow}, 0 0 20px ${colors.shadow}`;
                card.dataset.index = index;
                
                // Shine effect
                const shine = document.createElement('div');
                shine.className = 'absolute inset-0 opacity-20';
                shine.style.background = 'linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%)';
                card.appendChild(shine);
                
                // Letter badge
                const badge = document.createElement('div');
                badge.className = 'w-10 sm:w-14 lg:w-[70px] h-10 sm:h-14 lg:h-[70px] flex items-center justify-center text-lg sm:text-2xl lg:text-3xl font-black flex-shrink-0 relative z-10';
                badge.style.background = colors.border;
                badge.style.color = '#fff';
                badge.style.textShadow = '0 2px 4px rgba(0,0,0,0.3)';
                badge.textContent = letters[index];
                card.appendChild(badge);
                
                // Option text
                const text = document.createElement('div');
                text.className = 'flex-1 p-2 sm:p-3 lg:p-4 text-sm sm:text-base lg:text-lg font-bold relative z-10';
                text.style.color = '#fff';
                text.style.textShadow = '0 2px 4px rgba(0,0,0,0.3)';
                text.textContent = option;
                card.appendChild(text);
                
                fragment.appendChild(card);
            });
            container.appendChild(fragment);
        }

        function startTimer() {
            clearInterval(timer);
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                updateProgressBar();
                
                if (timeLeft <= 5) {
                    playSound('tick');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    showResults();
                }
            }, 1000);
        }

        function updateProgressBar() {
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                const percentage = (timeLeft / 20) * 100;
                progressBar.style.width = percentage + '%';
                
                if (timeLeft <= 5) {
                    progressBar.style.background = 'linear-gradient(90deg, #ff4466, #ff6688)';
                } else if (timeLeft <= 10) {
                    progressBar.style.background = 'linear-gradient(90deg, #ff9900, #ffaa33)';
                } else {
                    progressBar.style.background = 'linear-gradient(90deg, #00ff88, #00d9ff)';
                }
            }
        }

        function updateTimerDisplay() {
            const circle = domCache.timerCircle;
            if (!circle) return;
            
            circle.textContent = timeLeft;
            
            // Change color based on time left with neon glow
            if (timeLeft <= 5) {
                circle.style.background = '#ff4466';
                circle.style.borderColor = '#fff';
                circle.style.boxShadow = '0 0 30px rgba(255, 68, 102, 0.8)';
                circle.classList.add('timer-danger');
            } else if (timeLeft <= 10) {
                circle.style.background = '#ff9900';
                circle.style.borderColor = '#fff';
                circle.style.boxShadow = '0 0 25px rgba(255, 153, 0, 0.7)';
                circle.classList.add('timer-warning');
            } else {
                circle.style.background = '#0595AE';
                circle.style.borderColor = '#fff';
                circle.style.boxShadow = '0 0 20px rgba(5, 149, 174, 0.6)';
                circle.classList.remove('timer-warning', 'timer-danger');
            }
        }

        function handleAnswer(playerId, optionIndex, timestamp) {
            if (answers[playerId] || players[playerId]?.disconnected) return;

            const timeElapsed = timestamp - questionStartTime;
            const isCorrect = optionIndex === gameQuestions[currentQuestion].correct;

            answers[playerId] = {
                option: optionIndex,
                correct: isCorrect,
                time: timeElapsed
            };

            if (isCorrect) {
                const points = Math.max(100, Math.floor(1000 - (timeElapsed / 20)));
                players[playerId].score += points;
                playSound('correct');
                
                airconsole.message(playerId, { 
                    action: 'result', 
                    correct: true, 
                    points: points
                });
            } else {
                playSound('wrong');
                airconsole.message(playerId, { 
                    action: 'result', 
                    correct: false, 
                    points: 0
                });
            }

            updatePlayersStatus();

            const activePlayers = Object.values(players).filter(p => !p.disconnected);
            if (Object.keys(answers).length >= activePlayers.length) {
                clearInterval(timer);
                setTimeout(() => showResults(), 800);
            }
        }

        function showResults() {
            clearInterval(timer);
            const question = gameQuestions[currentQuestion];
            
            const optionColors = [
                { bg: '#d4a574', border: '#b8894f' },
                { bg: '#4db8e8', border: '#3a9bc7' },
                { bg: '#e85d8a', border: '#c74a72' },
                { bg: '#9b6fd8', border: '#7d59b3' }
            ];
            
            const options = document.querySelectorAll('.option-card');
            options.forEach((opt, index) => {
                if (index === question.correct) {
                    opt.style.background = 'linear-gradient(135deg, #00ff88, #00cc66)';
                    opt.style.borderColor = '#00ff88';
                    opt.style.boxShadow = '0 0 30px rgba(0, 255, 136, 0.8), 0 4px 15px rgba(0, 255, 136, 0.5)';
                    opt.classList.add('option-correct');
                    opt.querySelector('.flex-1').style.color = '#fff';
                    
                    // Update badge color
                    const badge = opt.querySelector('div:first-child');
                    if (badge) {
                        badge.style.background = '#00cc66';
                    }
                } else {
                    const wasSelected = Object.values(answers).some(a => a.option === index);
                    if (wasSelected) {
                        opt.style.background = 'linear-gradient(135deg, #ff4466, #cc3355)';
                        opt.style.borderColor = '#ff4466';
                        opt.style.boxShadow = '0 0 30px rgba(255, 68, 102, 0.8), 0 4px 15px rgba(255, 68, 102, 0.5)';
                        opt.classList.add('option-incorrect');
                        opt.querySelector('.flex-1').style.color = '#fff';
                        
                        // Update badge color
                        const badge = opt.querySelector('div:first-child');
                        if (badge) {
                            badge.style.background = '#cc3355';
                        }
                    }
                }
            });

            updateScoreboard();
            
            airconsole.broadcast({
                action: 'showAnswer',
                correctIndex: question.correct
            });

            setTimeout(() => {
                if (currentQuestion < gameQuestions.length - 1) {
                    currentQuestion++;
                    showQuestion();
                    airconsole.broadcast({ 
                        action: 'nextQuestion', 
                        question: { index: currentQuestion, total: gameQuestions.length }
                    });
                } else {
                    endGame();
                }
            }, 2500);
        }

        function updateScoreboard() {
            // Scoreboard is now integrated into the player header cards
            // Just update the player cards with new scores
            updatePlayersStatus();
            
            const sortedPlayers = Object.values(players)
                .filter(p => !p.disconnected)
                .sort((a, b) => b.score - a.score);
            
            airconsole.broadcast({ action: 'leaderboardUpdate', players: sortedPlayers });
        }

        function endGame() {
            gameState = 'gameEnd';
            showScreen('end');
            
            const sortedPlayers = Object.values(players)
                .filter(p => !p.disconnected)
                .sort((a, b) => b.score - a.score);
            
            const winnerSection = document.getElementById('winnerSection');
            if (sortedPlayers.length > 0) {
                const winner = sortedPlayers[0];
                winnerSection.innerHTML = `
                    <div class="text-3xl sm:text-5xl lg:text-6xl mb-2 sm:mb-4">1er Lugar</div>
                    <div class="flex justify-center mb-2 sm:mb-4">
                        <div class="player-avatar-visual-large" style="background-color: ${winner.color};"></div>
                    </div>
                    <div class="text-xl sm:text-2xl lg:text-3xl font-bold text-steam-naranja">${winner.name}</div>
                    <div class="text-base sm:text-lg lg:text-xl text-steam-verde mt-1 sm:mt-2">${winner.score} puntos</div>
                `;
                
                playSound('victory');
                createConfetti();
            }
            
            const podium = document.getElementById('podium');
            podium.innerHTML = '';
            
            const medals = ['1ro', '2do', '3ro'];
            const podiumBg = ['bg-gradient-to-r from-yellow-100 to-amber-100 border-steam-naranja', 'bg-gradient-to-r from-gray-100 to-gray-200 border-gray-400', 'bg-gradient-to-r from-orange-100 to-amber-100 border-orange-400'];
            
            sortedPlayers.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = `flex items-center justify-between p-2 sm:p-3 lg:p-4 rounded-lg sm:rounded-xl lg:rounded-2xl border-2 sm:border-[3px] shadow-md ${podiumBg[index] || 'bg-white border-gray-200'}`;
                item.innerHTML = `
                    <div class="flex items-center gap-2 sm:gap-3 lg:gap-4">
                        <span class="text-lg sm:text-xl lg:text-2xl font-bold">${medals[index] || `#${index + 1}`}</span>
                        <div class="player-avatar-visual" style="background-color: ${player.color};"></div>
                        <span class="text-sm sm:text-base lg:text-lg font-bold">${player.name}</span>
                    </div>
                    <span class="text-base sm:text-lg lg:text-xl font-bold text-steam-turquesa">${player.score} pts</span>
                `;
                podium.appendChild(item);
            });

            airconsole.broadcast({ 
                action: 'gameEnd', 
                winner: sortedPlayers[0],
                players: sortedPlayers
            });
        }

        function resetGame() {
            gameState = 'categorySelect';
            currentQuestion = 0;
            answers = {};
            clearInterval(timer);
            
            Object.keys(players).forEach(id => {
                players[id].score = 0;
            });
            
            showScreen('category');
            airconsole.broadcast({ action: 'reset', gameState: 'categorySelect' });
        }

        function showScreen(screen) {
            document.querySelectorAll('.screen').forEach(s => {
                s.classList.remove('active');
            });
            
            const targetScreen = document.getElementById(screen + 'Screen');
            if (targetScreen) {
                targetScreen.classList.add('active');
            }
        }

        window.onload = init;
    </script>
</body>
</html>